<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.27">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Salman Naqvi">
<meta name="description" content="Reimplementing a light version of SolveIt with FastHTML, Basecoat, and within SolveIt.">

<title>Building SolveIt in SolveIt – ForBo7 // Salman Naqvi</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" integrity="sha384-ZvpUoO/+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn/6Z/hRTt8+pR6L4N2" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../favicon.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-ed96de9b727972fe78a7b5d16c58bf87.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-7c1e9744246cb75393526fa05decce7b.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/quarto-contrib/line-highlight-1.0.0/line-highlight.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdn.jsdelivr.net/npm/requirejs@2.3.6/require.min.js" integrity="sha384-c9c+LnTbwQ3aujuU7ULEPVvgLs+Fn6fJUvIGTsuu1ZcCf11fiEubah0ttpca4ntM sha384-6V1/AdqZRWk1KAlWbKBlGhN7VG4iE/yAZcO6NZPMF8od0vukrvr0tg4qY6NSrItx" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../../styles.css">
<meta property="og:title" content="Building SolveIt in SolveIt – ForBo7 // Salman Naqvi">
<meta property="og:description" content="I give you a challenge: can you build SolveIt in SolveIt in SolveIt?">
<meta property="og:image" content="https://forbo7.github.io/forblog/images/31_solveit_in_solveit/thumbnail.png">
<meta property="og:site_name" content="ForBo7 // Salman Naqvi">
<meta property="og:image:height" content="1466">
<meta property="og:image:width" content="1840">
<meta name="twitter:title" content="ForBo7 // Salman Naqvi">
<meta name="twitter:description" content="I give you a challenge: can you build SolveIt in SolveIt in SolveIt?">
<meta name="twitter:image" content="https://forbo7.github.io/forblog/images/31_solveit_in_solveit/thumbnail.png">
<meta name="twitter:creator" content="@ForBo7">
<meta name="twitter:site" content="@ForBo7">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image-height" content="1466">
<meta name="twitter:image-width" content="1840">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">ForBo7 // Salman Naqvi</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> <i class="bi bi-house-door" role="img">
</i> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../forblog/index.html"> <i class="bi bi-newspaper" role="img">
</i> 
<span class="menu-text">ForBlog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../bitsandbobs/index.html"> <i class="bi bi-puzzle" role="img">
</i> 
<span class="menu-text">Bits and Bobs</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../dictionary/index.html"> <i class="bi bi-book" role="img">
</i> 
<span class="menu-text">Dictionary</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> <i class="bi bi-file-person" role="img">
</i> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
    <a href="https://github.com/ForBo7/forbo7.github.io" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-code-slash"></i></a>
    <a href="../../forblog/index.xml" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-rss"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#settings-and-headers" id="toc-settings-and-headers" class="nav-link active" data-scroll-target="#settings-and-headers">Settings and Headers</a></li>
  <li><a href="#preview" id="toc-preview" class="nav-link" data-scroll-target="#preview">Preview</a></li>
  <li><a href="#database" id="toc-database" class="nav-link" data-scroll-target="#database">Database</a></li>
  <li><a href="#new-dialog" id="toc-new-dialog" class="nav-link" data-scroll-target="#new-dialog">New Dialog</a></li>
  <li><a href="#session-persistance" id="toc-session-persistance" class="nav-link" data-scroll-target="#session-persistance">Session Persistance</a></li>
  <li><a href="#localization" id="toc-localization" class="nav-link" data-scroll-target="#localization">Localization</a></li>
  <li><a href="#chat-bubbles" id="toc-chat-bubbles" class="nav-link" data-scroll-target="#chat-bubbles">Chat Bubbles</a></li>
  <li><a href="#component-wrappers" id="toc-component-wrappers" class="nav-link" data-scroll-target="#component-wrappers">Component Wrappers</a></li>
  <li><a href="#input-box" id="toc-input-box" class="nav-link" data-scroll-target="#input-box">Input Box</a></li>
  <li><a href="#button" id="toc-button" class="nav-link" data-scroll-target="#button">Button</a></li>
  <li><a href="#route-helper-functions" id="toc-route-helper-functions" class="nav-link" data-scroll-target="#route-helper-functions">Route Helper Functions</a></li>
  <li><a href="#llm-route" id="toc-llm-route" class="nav-link" data-scroll-target="#llm-route">LLM Route</a></li>
  <li><a href="#code-route" id="toc-code-route" class="nav-link" data-scroll-target="#code-route">Code Route</a></li>
  <li><a href="#note-route" id="toc-note-route" class="nav-link" data-scroll-target="#note-route">Note Route</a></li>
  <li><a href="#editor-component" id="toc-editor-component" class="nav-link" data-scroll-target="#editor-component">Editor Component</a></li>
  <li><a href="#tabs" id="toc-tabs" class="nav-link" data-scroll-target="#tabs">Tabs</a></li>
  <li><a href="#render-existing-messages" id="toc-render-existing-messages" class="nav-link" data-scroll-target="#render-existing-messages">Render Existing Messages</a></li>
  <li><a href="#dialog" id="toc-dialog" class="nav-link" data-scroll-target="#dialog">Dialog</a></li>
  <li><a href="#delete-dialog" id="toc-delete-dialog" class="nav-link" data-scroll-target="#delete-dialog">Delete Dialog</a></li>
  <li><a href="#restore-dialog" id="toc-restore-dialog" class="nav-link" data-scroll-target="#restore-dialog">Restore Dialog</a></li>
  <li><a href="#dialog-list" id="toc-dialog-list" class="nav-link" data-scroll-target="#dialog-list">Dialog List</a></li>
  <li><a href="#main-page" id="toc-main-page" class="nav-link" data-scroll-target="#main-page">Main Page</a></li>
  <li><a href="#deploy" id="toc-deploy" class="nav-link" data-scroll-target="#deploy">Deploy</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Building SolveIt in SolveIt</h1>
<p class="subtitle lead">I give you a challenge: can you build SolveIt in SolveIt in SolveIt?</p>
  <div class="quarto-categories">
    <div class="quarto-category">Agents</div>
    <div class="quarto-category">Approaching AI</div>
    <div class="quarto-category">LLMs</div>
    <div class="quarto-category">SolveIt</div>
    <div class="quarto-category">Programming</div>
    <div class="quarto-category">HTML</div>
  </div>
  </div>

<div>
  <div class="description">
    Reimplementing a light version of SolveIt with FastHTML, Basecoat, and within SolveIt.
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Salman Naqvi </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">Thursday, 22 January 2026</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p><img src="../images/31_solveit_in_solveit/thumbnail.png" class="img-fluid"></p>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>This app is built on the techniques taught in Lessons 4, 5, and 6 of the SolveIt course led by <a href="https://solve.it.com/#im-jeremy-howard-from-fastai">Jeremy Howard</a> who created the first modern LLM in 2018, and <a href="https://www.johnowhitaker.com/">Johnothan Whitaker</a>. SolveIt is also a brilliant problem-solving framework and interactive platform, that puts you in control–not the LLM.</p>
<p>Also thanks to <a href="https://rensdimmendaal.com/">Rens Dimmendaal</a> for <a href="https://share.solve.it.com/d/5426704f61ba89b1ae547d6506929da7">his dialog</a> on how to deploy an app to <a href="https://pla.sh/">Plash</a> from SolveIt.</p>
</div>
</div>
</div>
<p>This blog post is a rendered documentation of a very, very basic reimplementation of <a href="solve.it.com">SolveIt</a> using FastHTML as the web framework. The main goal of this exercise was to exercise my web development and HTMX skillz. Play with the app <a href="https://solveit-lite-unofficial.pla.sh/">at this link</a>. Or watch the brief overview below.</p>
<div style="position: relative; padding-bottom: 56.25%; height: 0;">
<iframe src="https://cap.so/embed/k9xxnxzyfa19fms" frameborder="0" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen="" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;">
</iframe>
</div>
<p>SolveIt is an IDE of sorts that’s not only tailored towards coding, but a variety of other tasks from writing to problem solving to planning to learning to exploring and what not. Its premise revolves around the LLM putting the human in control, and thereby boosting human performance and capability. A core part of why SolveIt works so well is that your work <em>is</em> the LLM context.</p>
<p>Many parts of this app can still be improved, refactored, or made more efficient. Play with the app <a href="https://solveit-lite-unofficial.pla.sh/">at this link</a>.</p>
<p>Features include:</p>
<ul>
<li>Code/LLM/Note cells</li>
<li>Context aware LLM</li>
<li>Restore functionality</li>
<li>Create multiple dialogs</li>
<li>Rename dialogs</li>
<li>Chinese/English localization</li>
</ul>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>Certain FastHTML components of my app have been directly rendered as a part of this page. The FastHTML routes have not been and have been displayed as an image–these would otherwise be rendered in a Jupyter Notebook.</p>
</div>
</div>
</div>
<section id="settings-and-headers" class="level3">
<h3 class="anchored" data-anchor-id="settings-and-headers">Settings and Headers</h3>
<p>::: {#243ffab3 .cell 0=‘e’ 1=‘x’ 2=‘p’ 3=‘o’ 4=‘r’ 5=‘t’ time_run=‘2026-01-22T00:33:56.461282+00:00’}</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fasthtml.common <span class="im">import</span> <span class="op">*</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>:::</p>
<p>::: {#f9ccd095 .cell 0=‘e’ 1=‘x’ 2=‘p’ 3=‘o’ 4=‘r’ 5=‘t’ time_run=‘2026-01-22T00:33:56.462308+00:00’}</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>bsc_hdrs <span class="op">=</span> (</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    Script(src<span class="op">=</span><span class="st">"https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"</span>),  <span class="co"># Need to download first.</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    Link(rel<span class="op">=</span><span class="st">'stylesheet'</span>, href<span class="op">=</span><span class="st">'https://cdn.jsdelivr.net/npm/basecoat-css@0.3.6/dist/basecoat.cdn.min.css'</span>),</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    Script(src<span class="op">=</span><span class="st">'https://cdn.jsdelivr.net/npm/basecoat-css@0.3.6/dist/js/all.min.js'</span>, defer<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>:::</p>
<p>::: {#7d1e280a .cell 0=‘e’ 1=‘x’ 2=‘p’ 3=‘o’ 4=‘r’ 5=‘t’ time_run=‘2026-01-22T00:33:56.482447+00:00’}</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>app <span class="op">=</span> FastHTML(hdrs<span class="op">=</span>(bsc_hdrs, MarkdownJS(), HighlightJS(langs<span class="op">=</span>[<span class="st">'python'</span>])), session_cookie<span class="op">=</span><span class="st">'mysessioncookie'</span>, debug<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>rt <span class="op">=</span> app.route</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>:::</p>
<p>A custom session cookie needs to be set for FastHTML sessions to work in SolveIt as SolveIt currently uses the default one.</p>
</section>
<section id="preview" class="level3">
<h3 class="anchored" data-anchor-id="preview">Preview</h3>
<p>Here I create a preview helper function that will allow me to interactively preview various components of the app.</p>
<div id="852a294e" class="cell" data-time_run="2026-01-22T00:33:56.519355+00:00">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> functools <span class="im">import</span> partial</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fasthtml.jupyter <span class="im">import</span> <span class="op">*</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="2f10b55b" class="cell" data-time_run="2026-01-22T00:33:56.544206+00:00">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>server <span class="op">=</span> JupyUvi(app)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="7e804dcd" class="cell" data-time_run="2026-01-22T00:33:56.577126+00:00">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_preview(app):</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> partial(HTMX, app<span class="op">=</span>app, host<span class="op">=</span><span class="va">None</span>, port<span class="op">=</span><span class="va">None</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>prev <span class="op">=</span> get_preview(app)<span class="op">;</span> prev()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="0">
<iframe src="../../" style="width: 100%; height: auto; border: none;" onload="{
        let frame = this;
        window.addEventListener('message', function(e) {
            if (e.source !== frame.contentWindow) return; // Only proceed if the message is from this iframe
            if (e.data.height) frame.style.height = (e.data.height+1) + 'px';
        }, false);
    }" allow="accelerometer; autoplay; camera; clipboard-read; clipboard-write; display-capture; encrypted-media; fullscreen; gamepad; geolocation; gyroscope; hid; identity-credentials-get; idle-detection; magnetometer; microphone; midi; payment; picture-in-picture; publickey-credentials-get; screen-wake-lock; serial; usb; web-share; xr-spatial-tracking"></iframe> 
</div>
</div>
<div id="4d6427b8" class="cell" data-time_run="2026-01-22T00:33:56.607309+00:00">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>render_ft()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p><code>render_ft</code> will render any output FastHTML. <code>prev</code> will display it in the context of the FastHTML app.</p>
</section>
<section id="database" class="level3">
<h3 class="anchored" data-anchor-id="database">Database</h3>
<p>Creating a database to store users and their dialogs, with dialogs linked to users via <code>uid</code>.</p>
<p>::: {#1f39f676 .cell 0=‘e’ 1=‘x’ 2=‘p’ 3=‘o’ 4=‘r’ 5=‘t’ time_run=‘2026-01-22T00:33:56.637473+00:00’}</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastlite <span class="im">import</span> <span class="op">*</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>:::</p>
<p>::: {#88d6aa36 .cell 0=‘e’ 1=‘x’ 2=‘p’ 3=‘o’ 4=‘r’ 5=‘t’ time_run=‘2026-01-22T00:33:56.668265+00:00’}</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>db <span class="op">=</span> database(<span class="st">'solvish.db'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>:::</p>
<div id="bfa6f9fd" class="cell" data-time_run="2026-01-22T00:33:56.699037+00:00">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>db</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="0">
<pre data-code-line-numbers=""><code>&lt;Database &lt;apsw.Connection object "/app/data/forbo7.github.io/forblog/posts/solvish.db" at 0x70ee23760500&gt;&gt;</code></pre>
</div>
</div>
<p>::: {#dd112d66 .cell 0=‘e’ 1=‘x’ 2=‘p’ 3=‘o’ 4=‘r’ 5=‘t’ time_run=‘2026-01-22T00:33:57.092178+00:00’}</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> User: <span class="bu">id</span>:<span class="bu">int</span><span class="op">;</span> restore_code:<span class="bu">str</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Dialog: <span class="bu">id</span>:<span class="bu">int</span><span class="op">;</span> uid:<span class="bu">int</span><span class="op">;</span> dialog_num:<span class="bu">int</span><span class="op">;</span> name:<span class="bu">str</span><span class="op">;</span> messages:<span class="bu">str</span><span class="op">;</span> server_session:<span class="bu">str</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>:::</p>
<p>::: {#6bd3be8e .cell 0=‘e’ 1=‘x’ 2=‘p’ 3=‘o’ 4=‘r’ 5=‘t’ time_run=‘2026-01-22T00:33:57.093191+00:00’}</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>users <span class="op">=</span> db.create(User, transform<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>dialogs <span class="op">=</span> db.create(Dialog, pk<span class="op">=</span>(<span class="st">'uid'</span>, <span class="st">'dialog_num'</span>), transform<span class="op">=</span><span class="va">True</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>:::</p>
<p>Tables will not be overwritten as <code>db.create()</code> is idempotent.</p>
<div id="3638ca94" class="cell" data-time_run="2026-01-22T00:33:57.124593+00:00">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>users.delete_where()</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>dialogs.delete_where()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="0">
<pre data-code-line-numbers=""><code>&lt;Table dialog (id, uid, dialog_num, name, messages, server_session)&gt;</code></pre>
</div>
</div>
<p><code>.delete_where</code> with no arguments passed will drop all rows from the table.</p>
</section>
<section id="new-dialog" class="level3">
<h3 class="anchored" data-anchor-id="new-dialog">New Dialog</h3>
<p>Creating a new dialog first auto-increments <code>dialog_num</code> based on the user’s existing dialogs, then sets <code>session['current_dialog']</code> to track which dialog is active. The dialog is stored in the <code>dialogs</code> table for persistence across sessions, while also being loaded into <code>user_chats</code> as a live chat object for the current server session.</p>
<p>::: {#b7b8f919 .cell 0=‘e’ 1=‘x’ 2=‘p’ 3=‘o’ 4=‘r’ 5=‘t’ time_run=‘2026-01-22T00:33:57.163073+00:00’}</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> lisette.core <span class="im">import</span> <span class="op">*</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> toolslm.shell <span class="im">import</span> get_shell</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>sp <span class="op">=</span> <span class="st">'Respond in the language the user uses; The user has access to a Python interpreter that you can view; NEVER copy the format of the code interpreter messsages in your response.'</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> make_chat(hist<span class="op">=</span>[]): <span class="cf">return</span> Chat(<span class="st">'moonshot/kimi-k2-0711-preview'</span>, hist<span class="op">=</span>hist, sp<span class="op">=</span>sp), get_shell()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>:::</p>
<div id="1bfb32c4" class="cell" data-time_run="2026-01-22T00:33:58.698358+00:00">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>make_chat()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="0">
<pre data-code-line-numbers=""><code>(&lt;lisette.core.Chat at 0x70ee1a849eb0&gt;,
 &lt;IPython.terminal.interactiveshell.TerminalInteractiveShell at 0x70ee1a849f40&gt;)</code></pre>
</div>
</div>
<p>As my Kimi API key is compatable with servers in China, I have to change the Moonshoot endpoint.</p>
<p>::: {#35143833 .cell 0=‘e’ 1=‘x’ 2=‘p’ 3=‘o’ 4=‘r’ 5=‘t’ time_run=‘2026-01-22T00:33:58.702646+00:00’}</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>os.environ[<span class="st">'MOONSHOT_API_BASE'</span>] <span class="op">=</span> <span class="st">'https://api.moonshot.cn/v1'</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>:::</p>
<div id="7528bd96" class="cell" data-time_run="2026-01-22T00:33:58.706844+00:00">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># from cachy import enable_cachy; enable_cachy()</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p><a href="https://github.com/AnswerDotAI/cachy">cachy</a> will cache my API calls.</p>
<div id="bed3a9e7" class="cell" data-time_run="2026-01-22T00:33:58.730016+00:00">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>make_chat()[<span class="dv">0</span>](<span class="st">'what do you have access to?'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="0">
<p>I can see everything you see in the chat, including any code you run and its output. I don’t have direct access to your file system, network, or any other external resources—only what you explicitly show me in the conversation.</p>
<details>
<ul>
<li>id: <code>chatcmpl-6971707810ede230dafd4d84</code></li>
<li>model: <code>moonshot/kimi-k2-0711-preview</code></li>
<li>finish_reason: <code>stop</code></li>
<li>usage: <code>Usage(completion_tokens=49, prompt_tokens=54, total_tokens=103, completion_tokens_details=None, prompt_tokens_details=None)</code></li>
</ul>
</details>
</div>
</div>
<p>::: {#50efa44f .cell 0=‘e’ 1=‘x’ 2=‘p’ 3=‘o’ 4=‘r’ 5=‘t’ time_run=‘2026-01-22T00:34:01.492003+00:00’}</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> coolname <span class="im">import</span> generate_slug</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="at">@rt</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_dialog(session):</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    uid <span class="op">=</span> session.get(<span class="st">'userid'</span>)</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    existing <span class="op">=</span> dialogs(where<span class="op">=</span><span class="ss">f'uid=</span><span class="sc">{</span>uid<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    dnum <span class="op">=</span> <span class="bu">max</span>((d.dialog_num <span class="cf">for</span> d <span class="kw">in</span> existing), default<span class="op">=</span><span class="dv">0</span>) <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    session[<span class="st">'current_dialog'</span>] <span class="op">=</span> dnum</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    dialogs.insert(uid<span class="op">=</span>uid, dialog_num<span class="op">=</span>dnum, name<span class="op">=</span>generate_slug(<span class="dv">2</span>), messages<span class="op">=</span><span class="st">'[]'</span>)</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    user_chats[(uid,dnum)] <span class="op">=</span> make_chat()</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> Div(hx_get<span class="op">=</span><span class="ss">f'/dialog?dnum=</span><span class="sc">{</span>dnum<span class="sc">}</span><span class="ss">'</span>, hx_trigger<span class="op">=</span><span class="st">'load'</span>, hx_target<span class="op">=</span><span class="st">'#content'</span>, hx_swap<span class="op">=</span><span class="st">'innerHTML'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>:::</p>
</section>
<section id="session-persistance" class="level3">
<h3 class="anchored" data-anchor-id="session-persistance">Session Persistance</h3>
<p>::: {#67b4dc4e .cell 0=‘e’ 1=‘x’ 2=‘p’ 3=‘o’ 4=‘r’ 5=‘t’ time_run=‘2026-01-22T00:34:01.506942+00:00’}</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>user_chats <span class="op">=</span> {}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>:::</p>
<p>I’ll be handling session persistance with this <code>user_chats</code> dictionary. If my server restarts, it means <code>user_chats</code> will be erased and thus a new session will be created for all users. Users can input their restore code to retrieve back their data.</p>
<p>::: {#89ceda80 .cell 0=‘e’ 1=‘x’ 2=‘p’ 3=‘o’ 4=‘r’ 5=‘t’ time_run=‘2026-01-22T00:34:01.511262+00:00’}</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> ensure_user(session):</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    uid <span class="op">=</span> session.get(<span class="st">'userid'</span>)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> uid <span class="kw">or</span> uid <span class="kw">not</span> <span class="kw">in</span> users:</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>        u <span class="op">=</span> users.insert(restore_code<span class="op">=</span>generate_slug(<span class="dv">3</span>))</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>        session[<span class="st">'userid'</span>] <span class="op">=</span> u.<span class="bu">id</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> session[<span class="st">'userid'</span>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>:::</p>
<div id="cec05240" class="cell" data-time_run="2026-01-22T00:34:01.515256+00:00">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>fake_session <span class="op">=</span> {}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="597936b9" class="cell" data-time_run="2026-01-22T00:34:01.519295+00:00">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>uid <span class="op">=</span> ensure_user(fake_session)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>fake_session, uid</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="0">
<pre data-code-line-numbers=""><code>({'userid': 1}, 1)</code></pre>
</div>
</div>
<p>::: {#9ac5a9ef .cell 0=‘e’ 1=‘x’ 2=‘p’ 3=‘o’ 4=‘r’ 5=‘t’ time_run=‘2026-01-22T00:34:01.526400+00:00’}</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastcore.<span class="bu">all</span> <span class="im">import</span> <span class="op">*</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> ensure_dialog(session):</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    uid, dnum <span class="op">=</span> <span class="bu">map</span>(session.get, (<span class="st">'userid'</span>, <span class="st">'current_dialog'</span>))</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (uid, dnum) <span class="kw">in</span> user_chats: <span class="cf">return</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> dnum <span class="kw">and</span> (uid, dnum) <span class="kw">in</span> dialogs: </span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>        d <span class="op">=</span> dialogs[(uid, dnum)]</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>        user_chats[(uid, dnum)] <span class="op">=</span> make_chat(json.loads(d.messages))</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>: create_dialog(session)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>:::</p>
<p><code>ensure_dialog</code> acts as a lazy loader for chat sessions. It first checks whether the user’s current dialog is already active in memory—if so, there’s nothing to do. If the dialog exists in the database but hasn’t been loaded yet, it retrieves the stored messages and reconstructs the chat object. Otherwise, when no dialog exists at all, it creates a fresh one for the user.</p>
<div id="34873f4b" class="cell" data-time_run="2026-01-22T00:34:01.530255+00:00">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>ensure_dialog(fake_session)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>user_chats</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="0">
<pre data-code-line-numbers=""><code>{(1, 1): (&lt;lisette.core.Chat at 0x70ee1a6efda0&gt;,
  &lt;IPython.terminal.interactiveshell.TerminalInteractiveShell at 0x70ee225f31a0&gt;)}</code></pre>
</div>
</div>
<p>::: {#f4bf5236 .cell 0=‘e’ 1=‘x’ 2=‘p’ 3=‘o’ 4=‘r’ 5=‘t’ time_run=‘2026-01-22T00:34:01.546425+00:00’}</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb31" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> contextvars <span class="im">import</span> ContextVar</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>current_lang <span class="op">=</span> ContextVar(<span class="st">'lang'</span>, default<span class="op">=</span><span class="st">'en'</span>)<span class="op">;</span> current_lang</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="0">
<pre data-code-line-numbers=""><code>&lt;ContextVar name='lang' default='en' at 0x70ee19141df0&gt;</code></pre>
</div>
<p>:::</p>
<p>Every time a request is made, a new <code>ContextVar</code> is created. This is a way I can keep language preferences seperate for each user.</p>
<p>::: {#f4830cbf .cell 0=‘e’ 1=‘x’ 2=‘p’ 3=‘o’ 4=‘r’ 5=‘t’ time_run=‘2026-01-22T00:34:01.551464+00:00’}</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="at">@rt</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> setsession(session):</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    current_lang.<span class="bu">set</span>(session.setdefault(<span class="st">'lang'</span>, <span class="st">'en'</span>))</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    uid <span class="op">=</span> ensure_user(session)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>    ensure_dialog(session)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>:::</p>
<div id="217c47ba" class="cell" data-time_run="2026-01-22T00:34:01.559257+00:00">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb34" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>prev(setsession)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="0">
<iframe src="../../setsession" style="width: 100%; height: auto; border: none;" onload="{
        let frame = this;
        window.addEventListener('message', function(e) {
            if (e.source !== frame.contentWindow) return; // Only proceed if the message is from this iframe
            if (e.data.height) frame.style.height = (e.data.height+1) + 'px';
        }, false);
    }" allow="accelerometer; autoplay; camera; clipboard-read; clipboard-write; display-capture; encrypted-media; fullscreen; gamepad; geolocation; gyroscope; hid; identity-credentials-get; idle-detection; magnetometer; microphone; midi; payment; picture-in-picture; publickey-credentials-get; screen-wake-lock; serial; usb; web-share; xr-spatial-tracking"></iframe> 
</div>
</div>
<p>The cookie only stores the user id. The data for the user is stored inside the current Python runtime. Once the runtime ends, the data is lost. The database permanently stores everything.</p>
<div id="b7100b29" class="cell" data-time_run="2026-01-22T00:34:01.563685+00:00">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>users()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="0">
<pre data-code-line-numbers=""><code>[User(id=1, restore_code='provocative-lori-of-acceptance')]</code></pre>
</div>
</div>
<div id="cee82adb" class="cell" data-time_run="2026-01-22T00:34:01.568674+00:00">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb37" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>dialogs()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="0">
<pre data-code-line-numbers=""><code>[Dialog(id=None, uid=1, dialog_num=1, name='viridian-pegasus', messages='[]', server_session=None)]</code></pre>
</div>
</div>
<div id="a89acb85" class="cell" data-time_run="2026-01-22T00:34:01.573660+00:00">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb39" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>user_chats</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="0">
<pre data-code-line-numbers=""><code>{(1, 1): (&lt;lisette.core.Chat at 0x70ee1a6efda0&gt;,
  &lt;IPython.terminal.interactiveshell.TerminalInteractiveShell at 0x70ee225f31a0&gt;)}</code></pre>
</div>
</div>
<div id="32122c5b" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb41" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="at">@rt</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> debug(session):</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> Pre(<span class="bu">str</span>(<span class="bu">dict</span>(session)))</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>prev(debug)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p><img src="../images/31_solveit_in_solveit/1.png" class="img-fluid"></p>
<div id="eacb8df3" class="cell" data-time_run="2026-01-22T00:34:01.583556+00:00">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb42" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="at">@rt</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> reset(session):</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>    session.clear()</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>    users.delete_where()</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>    dialogs.delete_where()</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> session</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>I won’t be exporting these two routes into the final application, else it’d allow users to mess around with other users!</p>
</section>
<section id="localization" class="level3">
<h3 class="anchored" data-anchor-id="localization">Localization</h3>
<p>A translation dictionary stores the strings for both Chinese and English. The helper function <code>t()</code> performs the localization.</p>
<p>::: {#95173331 .cell 0=‘e’ 1=‘x’ 2=‘p’ 3=‘o’ 4=‘r’ 5=‘t’ hide_input=‘true’ time_run=‘2026-01-22T00:34:01.589178+00:00’}</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb43" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>T <span class="op">=</span> {</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'zh'</span>: {</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">'input_placeholder'</span>: <span class="st">'输入内容···'</span>,</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">'submit'</span>: <span class="st">'提交'</span>,</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">'ask_model'</span>: <span class="st">'问问模型···'</span>,</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">'your_code'</span>: <span class="st">'你的代码···'</span>,</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">'any_thoughts'</span>: <span class="st">'有啥想法···'</span>,</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">'enter_code'</span>: <span class="st">'输入代码···'</span>,</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">'code'</span>: <span class="st">'代码'</span>,</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">'prompt'</span>: <span class="st">'题词'</span>,</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">'note'</span>: <span class="st">'笔记'</span>,</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">'tab'</span>: <span class="st">'标签'</span>,</span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>        <span class="st">'all_dialogs'</span>: <span class="st">'所有对话'</span>,</span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>        <span class="st">'new_dialog'</span>: <span class="st">'新对话'</span>,</span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>        <span class="st">'delete'</span>: <span class="st">'删除'</span>,</span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>        <span class="st">'save'</span>: <span class="st">'保存'</span>,</span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>        <span class="st">'solveit_lite'</span>: <span class="st">'solveit-轻量版'</span>,</span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>        <span class="st">'footer'</span>: <span class="st">'由 FastHTML 匠心打造'</span>,</span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>        <span class="st">'restore_code'</span>: <span class="st">'恢复码'</span>,</span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a>        <span class="st">'restore_failed'</span>: <span class="st">'‼ 恢复失败'</span>,</span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a>        <span class="st">'restore_error'</span>: <span class="st">'找不到与此恢复码关联的账户，请检查后重试。'</span>,</span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a>        <span class="st">'enter_restore_code'</span>: <span class="st">'输入恢复码···'</span>,</span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">'en'</span>: {</span>
<span id="cb43-25"><a href="#cb43-25" aria-hidden="true" tabindex="-1"></a>        <span class="st">'input_placeholder'</span>: <span class="st">'Enter content...'</span>,</span>
<span id="cb43-26"><a href="#cb43-26" aria-hidden="true" tabindex="-1"></a>        <span class="st">'submit'</span>: <span class="st">'Submit'</span>,</span>
<span id="cb43-27"><a href="#cb43-27" aria-hidden="true" tabindex="-1"></a>        <span class="st">'ask_model'</span>: <span class="st">'Ask the model...'</span>,</span>
<span id="cb43-28"><a href="#cb43-28" aria-hidden="true" tabindex="-1"></a>        <span class="st">'your_code'</span>: <span class="st">'Your code...'</span>,</span>
<span id="cb43-29"><a href="#cb43-29" aria-hidden="true" tabindex="-1"></a>        <span class="st">'any_thoughts'</span>: <span class="st">'Any thoughts...'</span>,</span>
<span id="cb43-30"><a href="#cb43-30" aria-hidden="true" tabindex="-1"></a>        <span class="st">'enter_code'</span>: <span class="st">'Enter code...'</span>,</span>
<span id="cb43-31"><a href="#cb43-31" aria-hidden="true" tabindex="-1"></a>        <span class="st">'code'</span>: <span class="st">'Code'</span>,</span>
<span id="cb43-32"><a href="#cb43-32" aria-hidden="true" tabindex="-1"></a>        <span class="st">'prompt'</span>: <span class="st">'Prompt'</span>,</span>
<span id="cb43-33"><a href="#cb43-33" aria-hidden="true" tabindex="-1"></a>        <span class="st">'note'</span>: <span class="st">'Note'</span>,</span>
<span id="cb43-34"><a href="#cb43-34" aria-hidden="true" tabindex="-1"></a>        <span class="st">'tab'</span>: <span class="st">'Tab'</span>,</span>
<span id="cb43-35"><a href="#cb43-35" aria-hidden="true" tabindex="-1"></a>        <span class="st">'all_dialogs'</span>: <span class="st">'All Dialogs'</span>,</span>
<span id="cb43-36"><a href="#cb43-36" aria-hidden="true" tabindex="-1"></a>        <span class="st">'new_dialog'</span>: <span class="st">'New Dialog'</span>,</span>
<span id="cb43-37"><a href="#cb43-37" aria-hidden="true" tabindex="-1"></a>        <span class="st">'delete'</span>: <span class="st">'Delete'</span>,</span>
<span id="cb43-38"><a href="#cb43-38" aria-hidden="true" tabindex="-1"></a>        <span class="st">'save'</span>: <span class="st">'Save'</span>,</span>
<span id="cb43-39"><a href="#cb43-39" aria-hidden="true" tabindex="-1"></a>        <span class="st">'solveit_lite'</span>: <span class="st">'solveit-lite'</span>,</span>
<span id="cb43-40"><a href="#cb43-40" aria-hidden="true" tabindex="-1"></a>        <span class="st">'footer'</span>: <span class="st">'Crafted with FastHTML'</span>,</span>
<span id="cb43-41"><a href="#cb43-41" aria-hidden="true" tabindex="-1"></a>        <span class="st">'restore_code'</span>: <span class="st">'Restore Code'</span>,</span>
<span id="cb43-42"><a href="#cb43-42" aria-hidden="true" tabindex="-1"></a>        <span class="st">'restore_failed'</span>: <span class="st">'‼ Restore Failed'</span>,</span>
<span id="cb43-43"><a href="#cb43-43" aria-hidden="true" tabindex="-1"></a>        <span class="st">'restore_error'</span>: <span class="st">'No account found with this restore code. Please check and try again.'</span>,</span>
<span id="cb43-44"><a href="#cb43-44" aria-hidden="true" tabindex="-1"></a>        <span class="st">'enter_restore_code'</span>: <span class="st">'Enter restore code...'</span>,</span>
<span id="cb43-45"><a href="#cb43-45" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb43-46"><a href="#cb43-46" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>:::</p>
<p>::: {#f66dc855 .cell 0=‘e’ 1=‘x’ 2=‘p’ 3=‘o’ 4=‘r’ 5=‘t’ time_run=‘2026-01-22T00:34:01.593643+00:00’}</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb44" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> t(key, session<span class="op">=</span><span class="va">None</span>): </span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>    lang <span class="op">=</span> session.get(<span class="st">'lang'</span>, <span class="st">'zh'</span>) <span class="cf">if</span> session <span class="cf">else</span> current_lang.get()</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> T[lang].get(key, key)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>:::</p>
<div id="e3eddbdf" class="cell" data-time_run="2026-01-22T00:34:01.598015+00:00">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb45" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>t(<span class="st">'ask_model'</span>, {<span class="st">'lang'</span>:<span class="st">'zh'</span>})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="0">
<pre data-code-line-numbers=""><code>'问问模型···'</code></pre>
</div>
</div>
</section>
<section id="chat-bubbles" class="level3">
<h3 class="anchored" data-anchor-id="chat-bubbles">Chat Bubbles</h3>
<p>Bubbles that display the dialog content. Each bubble type has its own color scheme—blue for code, red for prompts, and green for notes.</p>
<p>::: {#4a5b2004 .cell 0=‘e’ 1=‘x’ 2=‘p’ 3=‘o’ 4=‘r’ 5=‘t’ time_run=‘2026-01-22T00:34:01.603161+00:00’}</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb47" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> Bubble(text, color, <span class="bu">type</span><span class="op">=</span><span class="st">'q'</span>, marked<span class="op">=</span><span class="va">True</span>):</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>    colors <span class="op">=</span> {</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">'code'</span>: <span class="st">'border-blue-500 bg-blue-50'</span>,</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">'note'</span>: <span class="st">'border-green-500 bg-green-50'</span>,</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">'prompt'</span>: <span class="st">'border-red-500 bg-red-50'</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>    cls <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span><span class="st">'marked'</span> <span class="cf">if</span> marked <span class="cf">else</span> <span class="st">''</span><span class="sc">}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'ml-6'</span> <span class="cf">if</span> <span class="bu">type</span><span class="op">==</span><span class="st">'r'</span> <span class="cf">else</span> <span class="st">''</span><span class="sc">}</span><span class="ss"> flex w-max max-w-[75%] flex-col gap-2 rounded-lg px-3 py-2 text-sm border-2 </span><span class="sc">{</span>colors[color]<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> Div(text, cls<span class="op">=</span>cls)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>:::</p>
<div id="8576ee05" class="cell" data-time_run="2026-01-22T00:34:01.608117+00:00">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb48" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>prev(Bubble(<span class="st">'**嗨喽**'</span>, <span class="st">'note'</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="0">
<iframe srcdoc=" <!doctype html>
 <html>
   <head>
     <title>FastHTML page</title>
     <link rel=&quot;canonical&quot; href=&quot;https://testserver/_34x6U4i3QgWOfs8gF0Af-A&quot;>
     <meta charset=&quot;utf-8&quot;>
     <meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1, viewport-fit=cover&quot;>
<script src=&quot;https://cdn.jsdelivr.net/npm/htmx.org@2.0.7/dist/htmx.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/gh/answerdotai/fasthtml-js@1.0.12/fasthtml.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/gh/answerdotai/surreal@main/surreal.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/gh/gnat/css-scope-inline@main/script.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4&quot;></script>     <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/basecoat-css@0.3.6/dist/basecoat.cdn.min.css&quot;>
<script src=&quot;https://cdn.jsdelivr.net/npm/basecoat-css@0.3.6/dist/js/all.min.js&quot; defer></script><script type=&quot;module&quot;>import { marked } from &quot;https://cdn.jsdelivr.net/npm/marked/lib/marked.esm.js&quot;;
proc_htmx('.marked', e => e.innerHTML = marked.parse(e.textContent));</script>     <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/styles/atom-one-dark.css&quot; media=&quot;(prefers-color-scheme: dark)&quot;>
     <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/styles/atom-one-light.css&quot; media=&quot;(prefers-color-scheme: light)&quot;>
<script src=&quot;https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/highlight.min.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/gh/arronhunt/highlightjs-copy/dist/highlightjs-copy.min.js&quot;></script>     <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/arronhunt/highlightjs-copy/dist/highlightjs-copy.min.css&quot;>
<script src=&quot;https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/languages/python.min.js&quot;></script><script type=&quot;module&quot;>
hljs.addPlugin(new CopyButtonPlugin());
hljs.configure({'cssSelector': 'pre code:not([data-highlighted=&quot;yes&quot;])'});
htmx.onLoad(hljs.highlightAll);</script><script>
    function sendmsg() {
        window.parent.postMessage({height: document.documentElement.offsetHeight}, '*');
    }
    window.onload = function() {
        sendmsg();
        document.body.addEventListener('htmx:afterSettle',    sendmsg);
        document.body.addEventListener('htmx:wsAfterMessage', sendmsg);
    };</script>   </head>
   <body>
     <div class=&quot;marked  flex w-max max-w-[75%] flex-col gap-2 rounded-lg px-3 py-2 text-sm border-2 border-green-500 bg-green-50&quot;>**嗨喽**</div>
   </body>
 </html>
" style="width: 100%; height: auto; border: none;" onload="{
        let frame = this;
        window.addEventListener('message', function(e) {
            if (e.source !== frame.contentWindow) return; // Only proceed if the message is from this iframe
            if (e.data.height) frame.style.height = (e.data.height+1) + 'px';
        }, false);
    }" allow="accelerometer; autoplay; camera; clipboard-read; clipboard-write; display-capture; encrypted-media; fullscreen; gamepad; geolocation; gyroscope; hid; identity-credentials-get; idle-detection; magnetometer; microphone; midi; payment; picture-in-picture; publickey-credentials-get; screen-wake-lock; serial; usb; web-share; xr-spatial-tracking"></iframe> 
</div>
</div>
<div id="52501953" class="cell" data-time_run="2026-01-22T00:34:01.620761+00:00">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb49" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>prev(Div(</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>    Bubble(<span class="st">'嗨！'</span>, <span class="st">'prompt'</span>),</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>    Bubble(<span class="st">'哈喽！'</span>, <span class="st">'prompt'</span>, <span class="st">'r'</span>)</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="0">
<iframe srcdoc=" <!doctype html>
 <html>
   <head>
     <title>FastHTML page</title>
     <link rel=&quot;canonical&quot; href=&quot;https://testserver/_5q6rS-FnQcC_yo66hZunZw&quot;>
     <meta charset=&quot;utf-8&quot;>
     <meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1, viewport-fit=cover&quot;>
<script src=&quot;https://cdn.jsdelivr.net/npm/htmx.org@2.0.7/dist/htmx.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/gh/answerdotai/fasthtml-js@1.0.12/fasthtml.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/gh/answerdotai/surreal@main/surreal.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/gh/gnat/css-scope-inline@main/script.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4&quot;></script>     <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/basecoat-css@0.3.6/dist/basecoat.cdn.min.css&quot;>
<script src=&quot;https://cdn.jsdelivr.net/npm/basecoat-css@0.3.6/dist/js/all.min.js&quot; defer></script><script type=&quot;module&quot;>import { marked } from &quot;https://cdn.jsdelivr.net/npm/marked/lib/marked.esm.js&quot;;
proc_htmx('.marked', e => e.innerHTML = marked.parse(e.textContent));</script>     <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/styles/atom-one-dark.css&quot; media=&quot;(prefers-color-scheme: dark)&quot;>
     <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/styles/atom-one-light.css&quot; media=&quot;(prefers-color-scheme: light)&quot;>
<script src=&quot;https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/highlight.min.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/gh/arronhunt/highlightjs-copy/dist/highlightjs-copy.min.js&quot;></script>     <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/arronhunt/highlightjs-copy/dist/highlightjs-copy.min.css&quot;>
<script src=&quot;https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/languages/python.min.js&quot;></script><script type=&quot;module&quot;>
hljs.addPlugin(new CopyButtonPlugin());
hljs.configure({'cssSelector': 'pre code:not([data-highlighted=&quot;yes&quot;])'});
htmx.onLoad(hljs.highlightAll);</script><script>
    function sendmsg() {
        window.parent.postMessage({height: document.documentElement.offsetHeight}, '*');
    }
    window.onload = function() {
        sendmsg();
        document.body.addEventListener('htmx:afterSettle',    sendmsg);
        document.body.addEventListener('htmx:wsAfterMessage', sendmsg);
    };</script>   </head>
   <body>
     <div>
       <div class=&quot;marked  flex w-max max-w-[75%] flex-col gap-2 rounded-lg px-3 py-2 text-sm border-2 border-red-500 bg-red-50&quot;>嗨！</div>
       <div class=&quot;marked ml-6 flex w-max max-w-[75%] flex-col gap-2 rounded-lg px-3 py-2 text-sm border-2 border-red-500 bg-red-50&quot;>哈喽！</div>
     </div>
   </body>
 </html>
" style="width: 100%; height: auto; border: none;" onload="{
        let frame = this;
        window.addEventListener('message', function(e) {
            if (e.source !== frame.contentWindow) return; // Only proceed if the message is from this iframe
            if (e.data.height) frame.style.height = (e.data.height+1) + 'px';
        }, false);
    }" allow="accelerometer; autoplay; camera; clipboard-read; clipboard-write; display-capture; encrypted-media; fullscreen; gamepad; geolocation; gyroscope; hid; identity-credentials-get; idle-detection; magnetometer; microphone; midi; payment; picture-in-picture; publickey-credentials-get; screen-wake-lock; serial; usb; web-share; xr-spatial-tracking"></iframe> 
</div>
</div>
<div id="b3329ee1" class="cell" data-time_run="2026-01-22T00:34:01.629036+00:00">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb50" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>prev(Bubble(<span class="st">'''</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="st">```py</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="st">print('嗨！！！')</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="st">'''</span>, <span class="st">'code'</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="0">
<iframe srcdoc=" <!doctype html>
 <html>
   <head>
     <title>FastHTML page</title>
     <link rel=&quot;canonical&quot; href=&quot;https://testserver/_YFilX3ZJTliSsC-UV4jZSw&quot;>
     <meta charset=&quot;utf-8&quot;>
     <meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1, viewport-fit=cover&quot;>
<script src=&quot;https://cdn.jsdelivr.net/npm/htmx.org@2.0.7/dist/htmx.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/gh/answerdotai/fasthtml-js@1.0.12/fasthtml.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/gh/answerdotai/surreal@main/surreal.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/gh/gnat/css-scope-inline@main/script.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4&quot;></script>     <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/basecoat-css@0.3.6/dist/basecoat.cdn.min.css&quot;>
<script src=&quot;https://cdn.jsdelivr.net/npm/basecoat-css@0.3.6/dist/js/all.min.js&quot; defer></script><script type=&quot;module&quot;>import { marked } from &quot;https://cdn.jsdelivr.net/npm/marked/lib/marked.esm.js&quot;;
proc_htmx('.marked', e => e.innerHTML = marked.parse(e.textContent));</script>     <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/styles/atom-one-dark.css&quot; media=&quot;(prefers-color-scheme: dark)&quot;>
     <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/styles/atom-one-light.css&quot; media=&quot;(prefers-color-scheme: light)&quot;>
<script src=&quot;https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/highlight.min.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/gh/arronhunt/highlightjs-copy/dist/highlightjs-copy.min.js&quot;></script>     <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/arronhunt/highlightjs-copy/dist/highlightjs-copy.min.css&quot;>
<script src=&quot;https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/languages/python.min.js&quot;></script><script type=&quot;module&quot;>
hljs.addPlugin(new CopyButtonPlugin());
hljs.configure({'cssSelector': 'pre code:not([data-highlighted=&quot;yes&quot;])'});
htmx.onLoad(hljs.highlightAll);</script><script>
    function sendmsg() {
        window.parent.postMessage({height: document.documentElement.offsetHeight}, '*');
    }
    window.onload = function() {
        sendmsg();
        document.body.addEventListener('htmx:afterSettle',    sendmsg);
        document.body.addEventListener('htmx:wsAfterMessage', sendmsg);
    };</script>   </head>
   <body>
     <div class=&quot;marked  flex w-max max-w-[75%] flex-col gap-2 rounded-lg px-3 py-2 text-sm border-2 border-blue-500 bg-blue-50&quot;>
```py
print('嗨！！！')
</div>
   </body>
 </html>
" style="width: 100%; height: auto; border: none;" onload="{
        let frame = this;
        window.addEventListener('message', function(e) {
            if (e.source !== frame.contentWindow) return; // Only proceed if the message is from this iframe
            if (e.data.height) frame.style.height = (e.data.height+1) + 'px';
        }, false);
    }" allow="accelerometer; autoplay; camera; clipboard-read; clipboard-write; display-capture; encrypted-media; fullscreen; gamepad; geolocation; gyroscope; hid; identity-credentials-get; idle-detection; magnetometer; microphone; midi; payment; picture-in-picture; publickey-credentials-get; screen-wake-lock; serial; usb; web-share; xr-spatial-tracking"></iframe> 
</div>
</div>
</section>
<section id="component-wrappers" class="level3">
<h3 class="anchored" data-anchor-id="component-wrappers">Component Wrappers</h3>
<p>::: {#06830b37 .cell 0=‘e’ 1=‘x’ 2=‘p’ 3=‘o’ 4=‘r’ 5=‘t’ time_run=‘2026-01-22T00:34:01.636405+00:00’}</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb51" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> fasthtml.components <span class="im">as</span> fc</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>:::</p>
<p>::: {#0db9e155 .cell 0=‘e’ 1=‘x’ 2=‘p’ 3=‘o’ 4=‘r’ 5=‘t’ time_run=‘2026-01-22T00:34:01.640925+00:00’}</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb52" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> mk_comp(name, def_cls):</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>    comp <span class="op">=</span> <span class="bu">getattr</span>(fc, name)</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">globals</span>()[name] <span class="op">=</span> <span class="kw">lambda</span> <span class="op">*</span>args, var<span class="op">=</span><span class="st">''</span>, cls<span class="op">=</span><span class="st">''</span>, <span class="op">**</span>kwargs: comp(<span class="op">*</span>args, cls<span class="op">=</span><span class="ss">f'</span><span class="sc">{</span>def_cls<span class="sc">}{</span><span class="st">"-"</span><span class="op">+</span>var <span class="cf">if</span> var <span class="cf">else</span> <span class="st">""</span><span class="sc">}</span><span class="ss"> </span><span class="sc">{</span>cls<span class="sc">}</span><span class="ss">'</span>, <span class="op">**</span>kwargs)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>:::</p>
<p>This wrapper will allow us to define HTML components with Basecoat styling without redundantly stating what that component is.</p>
<p>Before:</p>
<div id="9fe29f38" class="cell" data-time_run="2026-01-22T00:34:01.645789+00:00">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb53" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>prev(Button(<span class="st">'🔘'</span>, cls<span class="op">=</span><span class="st">'btn'</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="0">
<iframe srcdoc=" <!doctype html>
 <html>
   <head>
     <title>FastHTML page</title>
     <link rel=&quot;canonical&quot; href=&quot;https://testserver/_wPSsjh-xShy0E6KlF2xZhA&quot;>
     <meta charset=&quot;utf-8&quot;>
     <meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1, viewport-fit=cover&quot;>
<script src=&quot;https://cdn.jsdelivr.net/npm/htmx.org@2.0.7/dist/htmx.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/gh/answerdotai/fasthtml-js@1.0.12/fasthtml.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/gh/answerdotai/surreal@main/surreal.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/gh/gnat/css-scope-inline@main/script.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4&quot;></script>     <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/basecoat-css@0.3.6/dist/basecoat.cdn.min.css&quot;>
<script src=&quot;https://cdn.jsdelivr.net/npm/basecoat-css@0.3.6/dist/js/all.min.js&quot; defer></script><script type=&quot;module&quot;>import { marked } from &quot;https://cdn.jsdelivr.net/npm/marked/lib/marked.esm.js&quot;;
proc_htmx('.marked', e => e.innerHTML = marked.parse(e.textContent));</script>     <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/styles/atom-one-dark.css&quot; media=&quot;(prefers-color-scheme: dark)&quot;>
     <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/styles/atom-one-light.css&quot; media=&quot;(prefers-color-scheme: light)&quot;>
<script src=&quot;https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/highlight.min.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/gh/arronhunt/highlightjs-copy/dist/highlightjs-copy.min.js&quot;></script>     <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/arronhunt/highlightjs-copy/dist/highlightjs-copy.min.css&quot;>
<script src=&quot;https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/languages/python.min.js&quot;></script><script type=&quot;module&quot;>
hljs.addPlugin(new CopyButtonPlugin());
hljs.configure({'cssSelector': 'pre code:not([data-highlighted=&quot;yes&quot;])'});
htmx.onLoad(hljs.highlightAll);</script><script>
    function sendmsg() {
        window.parent.postMessage({height: document.documentElement.offsetHeight}, '*');
    }
    window.onload = function() {
        sendmsg();
        document.body.addEventListener('htmx:afterSettle',    sendmsg);
        document.body.addEventListener('htmx:wsAfterMessage', sendmsg);
    };</script>   </head>
   <body>
<button class=&quot;btn&quot;>🔘</button>   </body>
 </html>
" style="width: 100%; height: auto; border: none;" onload="{
        let frame = this;
        window.addEventListener('message', function(e) {
            if (e.source !== frame.contentWindow) return; // Only proceed if the message is from this iframe
            if (e.data.height) frame.style.height = (e.data.height+1) + 'px';
        }, false);
    }" allow="accelerometer; autoplay; camera; clipboard-read; clipboard-write; display-capture; encrypted-media; fullscreen; gamepad; geolocation; gyroscope; hid; identity-credentials-get; idle-detection; magnetometer; microphone; midi; payment; picture-in-picture; publickey-credentials-get; screen-wake-lock; serial; usb; web-share; xr-spatial-tracking"></iframe> 
</div>
</div>
<div id="b92813c9" class="cell" data-time_run="2026-01-22T00:34:01.653563+00:00">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb54" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>prev(Button(<span class="st">'🔘'</span>, cls<span class="op">=</span><span class="st">'btn-destructive'</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="0">
<iframe srcdoc=" <!doctype html>
 <html>
   <head>
     <title>FastHTML page</title>
     <link rel=&quot;canonical&quot; href=&quot;https://testserver/_dn0Weor9QM_BG9rkmjWdPg&quot;>
     <meta charset=&quot;utf-8&quot;>
     <meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1, viewport-fit=cover&quot;>
<script src=&quot;https://cdn.jsdelivr.net/npm/htmx.org@2.0.7/dist/htmx.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/gh/answerdotai/fasthtml-js@1.0.12/fasthtml.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/gh/answerdotai/surreal@main/surreal.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/gh/gnat/css-scope-inline@main/script.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4&quot;></script>     <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/basecoat-css@0.3.6/dist/basecoat.cdn.min.css&quot;>
<script src=&quot;https://cdn.jsdelivr.net/npm/basecoat-css@0.3.6/dist/js/all.min.js&quot; defer></script><script type=&quot;module&quot;>import { marked } from &quot;https://cdn.jsdelivr.net/npm/marked/lib/marked.esm.js&quot;;
proc_htmx('.marked', e => e.innerHTML = marked.parse(e.textContent));</script>     <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/styles/atom-one-dark.css&quot; media=&quot;(prefers-color-scheme: dark)&quot;>
     <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/styles/atom-one-light.css&quot; media=&quot;(prefers-color-scheme: light)&quot;>
<script src=&quot;https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/highlight.min.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/gh/arronhunt/highlightjs-copy/dist/highlightjs-copy.min.js&quot;></script>     <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/arronhunt/highlightjs-copy/dist/highlightjs-copy.min.css&quot;>
<script src=&quot;https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/languages/python.min.js&quot;></script><script type=&quot;module&quot;>
hljs.addPlugin(new CopyButtonPlugin());
hljs.configure({'cssSelector': 'pre code:not([data-highlighted=&quot;yes&quot;])'});
htmx.onLoad(hljs.highlightAll);</script><script>
    function sendmsg() {
        window.parent.postMessage({height: document.documentElement.offsetHeight}, '*');
    }
    window.onload = function() {
        sendmsg();
        document.body.addEventListener('htmx:afterSettle',    sendmsg);
        document.body.addEventListener('htmx:wsAfterMessage', sendmsg);
    };</script>   </head>
   <body>
<button class=&quot;btn-destructive&quot;>🔘</button>   </body>
 </html>
" style="width: 100%; height: auto; border: none;" onload="{
        let frame = this;
        window.addEventListener('message', function(e) {
            if (e.source !== frame.contentWindow) return; // Only proceed if the message is from this iframe
            if (e.data.height) frame.style.height = (e.data.height+1) + 'px';
        }, false);
    }" allow="accelerometer; autoplay; camera; clipboard-read; clipboard-write; display-capture; encrypted-media; fullscreen; gamepad; geolocation; gyroscope; hid; identity-credentials-get; idle-detection; magnetometer; microphone; midi; payment; picture-in-picture; publickey-credentials-get; screen-wake-lock; serial; usb; web-share; xr-spatial-tracking"></iframe> 
</div>
</div>
<p>::: {#2e0f1420 .cell 0=‘e’ 1=‘x’ 2=‘p’ 3=‘o’ 4=‘r’ 5=‘t’ time_run=‘2026-01-22T00:34:01.661349+00:00’}</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb55" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>mk_comp(<span class="st">'Button'</span>, <span class="st">'btn'</span>)</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>mk_comp(<span class="st">'Input'</span>, <span class="st">'input'</span>)</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>mk_comp(<span class="st">'Textarea'</span>, <span class="st">'textarea'</span>)</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>mk_comp(<span class="st">'Label'</span>, <span class="st">'label'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>:::</p>
<p>After:</p>
<div id="1f3f4ef0" class="cell" data-time_run="2026-01-22T00:34:01.666016+00:00">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb56" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>prev(Button(<span class="st">'🔘'</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="0">
<iframe srcdoc=" <!doctype html>
 <html>
   <head>
     <title>FastHTML page</title>
     <link rel=&quot;canonical&quot; href=&quot;https://testserver/_I5E3BaKwTty2oLZFYCOtag&quot;>
     <meta charset=&quot;utf-8&quot;>
     <meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1, viewport-fit=cover&quot;>
<script src=&quot;https://cdn.jsdelivr.net/npm/htmx.org@2.0.7/dist/htmx.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/gh/answerdotai/fasthtml-js@1.0.12/fasthtml.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/gh/answerdotai/surreal@main/surreal.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/gh/gnat/css-scope-inline@main/script.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4&quot;></script>     <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/basecoat-css@0.3.6/dist/basecoat.cdn.min.css&quot;>
<script src=&quot;https://cdn.jsdelivr.net/npm/basecoat-css@0.3.6/dist/js/all.min.js&quot; defer></script><script type=&quot;module&quot;>import { marked } from &quot;https://cdn.jsdelivr.net/npm/marked/lib/marked.esm.js&quot;;
proc_htmx('.marked', e => e.innerHTML = marked.parse(e.textContent));</script>     <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/styles/atom-one-dark.css&quot; media=&quot;(prefers-color-scheme: dark)&quot;>
     <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/styles/atom-one-light.css&quot; media=&quot;(prefers-color-scheme: light)&quot;>
<script src=&quot;https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/highlight.min.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/gh/arronhunt/highlightjs-copy/dist/highlightjs-copy.min.js&quot;></script>     <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/arronhunt/highlightjs-copy/dist/highlightjs-copy.min.css&quot;>
<script src=&quot;https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/languages/python.min.js&quot;></script><script type=&quot;module&quot;>
hljs.addPlugin(new CopyButtonPlugin());
hljs.configure({'cssSelector': 'pre code:not([data-highlighted=&quot;yes&quot;])'});
htmx.onLoad(hljs.highlightAll);</script><script>
    function sendmsg() {
        window.parent.postMessage({height: document.documentElement.offsetHeight}, '*');
    }
    window.onload = function() {
        sendmsg();
        document.body.addEventListener('htmx:afterSettle',    sendmsg);
        document.body.addEventListener('htmx:wsAfterMessage', sendmsg);
    };</script>   </head>
   <body>
<button class=&quot;btn &quot;>🔘</button>   </body>
 </html>
" style="width: 100%; height: auto; border: none;" onload="{
        let frame = this;
        window.addEventListener('message', function(e) {
            if (e.source !== frame.contentWindow) return; // Only proceed if the message is from this iframe
            if (e.data.height) frame.style.height = (e.data.height+1) + 'px';
        }, false);
    }" allow="accelerometer; autoplay; camera; clipboard-read; clipboard-write; display-capture; encrypted-media; fullscreen; gamepad; geolocation; gyroscope; hid; identity-credentials-get; idle-detection; magnetometer; microphone; midi; payment; picture-in-picture; publickey-credentials-get; screen-wake-lock; serial; usb; web-share; xr-spatial-tracking"></iframe> 
</div>
</div>
<div id="6b7cadcd" class="cell" data-time_run="2026-01-22T00:34:01.675653+00:00">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb57" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>prev(Button(<span class="st">'🔘'</span>, var<span class="op">=</span><span class="st">'destructive'</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="0">
<iframe srcdoc=" <!doctype html>
 <html>
   <head>
     <title>FastHTML page</title>
     <link rel=&quot;canonical&quot; href=&quot;https://testserver/_DrZqLJJoR4erbgwSjnlh8Q&quot;>
     <meta charset=&quot;utf-8&quot;>
     <meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1, viewport-fit=cover&quot;>
<script src=&quot;https://cdn.jsdelivr.net/npm/htmx.org@2.0.7/dist/htmx.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/gh/answerdotai/fasthtml-js@1.0.12/fasthtml.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/gh/answerdotai/surreal@main/surreal.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/gh/gnat/css-scope-inline@main/script.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4&quot;></script>     <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/basecoat-css@0.3.6/dist/basecoat.cdn.min.css&quot;>
<script src=&quot;https://cdn.jsdelivr.net/npm/basecoat-css@0.3.6/dist/js/all.min.js&quot; defer></script><script type=&quot;module&quot;>import { marked } from &quot;https://cdn.jsdelivr.net/npm/marked/lib/marked.esm.js&quot;;
proc_htmx('.marked', e => e.innerHTML = marked.parse(e.textContent));</script>     <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/styles/atom-one-dark.css&quot; media=&quot;(prefers-color-scheme: dark)&quot;>
     <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/styles/atom-one-light.css&quot; media=&quot;(prefers-color-scheme: light)&quot;>
<script src=&quot;https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/highlight.min.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/gh/arronhunt/highlightjs-copy/dist/highlightjs-copy.min.js&quot;></script>     <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/arronhunt/highlightjs-copy/dist/highlightjs-copy.min.css&quot;>
<script src=&quot;https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/languages/python.min.js&quot;></script><script type=&quot;module&quot;>
hljs.addPlugin(new CopyButtonPlugin());
hljs.configure({'cssSelector': 'pre code:not([data-highlighted=&quot;yes&quot;])'});
htmx.onLoad(hljs.highlightAll);</script><script>
    function sendmsg() {
        window.parent.postMessage({height: document.documentElement.offsetHeight}, '*');
    }
    window.onload = function() {
        sendmsg();
        document.body.addEventListener('htmx:afterSettle',    sendmsg);
        document.body.addEventListener('htmx:wsAfterMessage', sendmsg);
    };</script>   </head>
   <body>
<button class=&quot;btn-destructive &quot;>🔘</button>   </body>
 </html>
" style="width: 100%; height: auto; border: none;" onload="{
        let frame = this;
        window.addEventListener('message', function(e) {
            if (e.source !== frame.contentWindow) return; // Only proceed if the message is from this iframe
            if (e.data.height) frame.style.height = (e.data.height+1) + 'px';
        }, false);
    }" allow="accelerometer; autoplay; camera; clipboard-read; clipboard-write; display-capture; encrypted-media; fullscreen; gamepad; geolocation; gyroscope; hid; identity-credentials-get; idle-detection; magnetometer; microphone; midi; payment; picture-in-picture; publickey-credentials-get; screen-wake-lock; serial; usb; web-share; xr-spatial-tracking"></iframe> 
</div>
</div>
<div id="0f0d9e38" class="cell" data-time_run="2026-01-22T00:34:01.682473+00:00">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb58" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>to_xml(Button(<span class="st">'🔘'</span>)), to_xml(Button(<span class="st">'🔘'</span>, var<span class="op">=</span><span class="st">'destructive'</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="0">
<pre data-code-line-numbers=""><code>('&lt;button class="btn "&gt;🔘&lt;/button&gt;',
 '&lt;button class="btn-destructive "&gt;🔘&lt;/button&gt;')</code></pre>
</div>
</div>
</section>
<section id="input-box" class="level3">
<h3 class="anchored" data-anchor-id="input-box">Input Box</h3>
<p>The input area that will be used for entering messages to the dialog.</p>
<p>::: {#ae807178 .cell 0=‘e’ 1=‘x’ 2=‘p’ 3=‘o’ 4=‘r’ 5=‘t’ time_run=‘2026-01-22T00:34:01.687299+00:00’}</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb60" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> Inp(<span class="bu">type</span><span class="op">=</span><span class="st">'text'</span>, placeholder<span class="op">=</span><span class="st">'输入内容···'</span>, <span class="bu">id</span><span class="op">=</span><span class="st">'inp'</span>, oob<span class="op">=</span><span class="va">False</span>, <span class="op">**</span>kwargs): </span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> Textarea(<span class="bu">type</span><span class="op">=</span><span class="st">'text'</span>, rows<span class="op">=</span><span class="dv">1</span>, placeholder<span class="op">=</span>placeholder, <span class="bu">id</span><span class="op">=</span><span class="bu">id</span>, cls<span class="op">=</span><span class="st">'font-mono'</span>, <span class="op">**</span>(<span class="bu">dict</span>(hx_swap_oob<span class="op">=</span><span class="st">'true'</span>) <span class="cf">if</span> oob <span class="cf">else</span> {}), <span class="op">**</span>kwargs)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>:::</p>
<div id="5c85740e" class="cell" data-time_run="2026-01-22T00:34:01.692045+00:00">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb61" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>prev(Inp())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="0">
<iframe srcdoc=" <!doctype html>
 <html>
   <head>
     <title>FastHTML page</title>
     <link rel=&quot;canonical&quot; href=&quot;https://testserver/_SSBiqWjjROeZWow61_hEEQ&quot;>
     <meta charset=&quot;utf-8&quot;>
     <meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1, viewport-fit=cover&quot;>
<script src=&quot;https://cdn.jsdelivr.net/npm/htmx.org@2.0.7/dist/htmx.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/gh/answerdotai/fasthtml-js@1.0.12/fasthtml.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/gh/answerdotai/surreal@main/surreal.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/gh/gnat/css-scope-inline@main/script.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4&quot;></script>     <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/basecoat-css@0.3.6/dist/basecoat.cdn.min.css&quot;>
<script src=&quot;https://cdn.jsdelivr.net/npm/basecoat-css@0.3.6/dist/js/all.min.js&quot; defer></script><script type=&quot;module&quot;>import { marked } from &quot;https://cdn.jsdelivr.net/npm/marked/lib/marked.esm.js&quot;;
proc_htmx('.marked', e => e.innerHTML = marked.parse(e.textContent));</script>     <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/styles/atom-one-dark.css&quot; media=&quot;(prefers-color-scheme: dark)&quot;>
     <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/styles/atom-one-light.css&quot; media=&quot;(prefers-color-scheme: light)&quot;>
<script src=&quot;https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/highlight.min.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/gh/arronhunt/highlightjs-copy/dist/highlightjs-copy.min.js&quot;></script>     <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/arronhunt/highlightjs-copy/dist/highlightjs-copy.min.css&quot;>
<script src=&quot;https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/languages/python.min.js&quot;></script><script type=&quot;module&quot;>
hljs.addPlugin(new CopyButtonPlugin());
hljs.configure({'cssSelector': 'pre code:not([data-highlighted=&quot;yes&quot;])'});
htmx.onLoad(hljs.highlightAll);</script><script>
    function sendmsg() {
        window.parent.postMessage({height: document.documentElement.offsetHeight}, '*');
    }
    window.onload = function() {
        sendmsg();
        document.body.addEventListener('htmx:afterSettle',    sendmsg);
        document.body.addEventListener('htmx:wsAfterMessage', sendmsg);
    };</script>   </head>
   <body>
<textarea type=&quot;text&quot; rows=&quot;1&quot; placeholder=&quot;输入内容···&quot; id=&quot;inp&quot; class=&quot;textarea font-mono&quot; name=&quot;inp&quot;></textarea>   </body>
 </html>
" style="width: 100%; height: auto; border: none;" onload="{
        let frame = this;
        window.addEventListener('message', function(e) {
            if (e.source !== frame.contentWindow) return; // Only proceed if the message is from this iframe
            if (e.data.height) frame.style.height = (e.data.height+1) + 'px';
        }, false);
    }" allow="accelerometer; autoplay; camera; clipboard-read; clipboard-write; display-capture; encrypted-media; fullscreen; gamepad; geolocation; gyroscope; hid; identity-credentials-get; idle-detection; magnetometer; microphone; midi; payment; picture-in-picture; publickey-credentials-get; screen-wake-lock; serial; usb; web-share; xr-spatial-tracking"></iframe> 
</div>
</div>
<div id="3b0017be" class="cell" data-time_run="2026-01-22T00:34:01.699737+00:00">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb62" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>to_xml(Inp())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="0">
<pre data-code-line-numbers=""><code>'&lt;textarea type="text" rows="1" placeholder="输入内容···" id="inp" class="textarea font-mono" name="inp"&gt;&lt;/textarea&gt;'</code></pre>
</div>
</div>
</section>
<section id="button" class="level3">
<h3 class="anchored" data-anchor-id="button">Button</h3>
<div id="a3dd6f2f" class="cell" data-time_run="2026-01-22T00:34:01.705697+00:00">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb64" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>prev(Button(<span class="st">'提交'</span>, <span class="bu">type</span><span class="op">=</span><span class="st">'submit'</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="0">
<iframe srcdoc=" <!doctype html>
 <html>
   <head>
     <title>FastHTML page</title>
     <link rel=&quot;canonical&quot; href=&quot;https://testserver/_qXzP6u6kRtexYWRMRM1kdw&quot;>
     <meta charset=&quot;utf-8&quot;>
     <meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1, viewport-fit=cover&quot;>
<script src=&quot;https://cdn.jsdelivr.net/npm/htmx.org@2.0.7/dist/htmx.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/gh/answerdotai/fasthtml-js@1.0.12/fasthtml.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/gh/answerdotai/surreal@main/surreal.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/gh/gnat/css-scope-inline@main/script.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4&quot;></script>     <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/basecoat-css@0.3.6/dist/basecoat.cdn.min.css&quot;>
<script src=&quot;https://cdn.jsdelivr.net/npm/basecoat-css@0.3.6/dist/js/all.min.js&quot; defer></script><script type=&quot;module&quot;>import { marked } from &quot;https://cdn.jsdelivr.net/npm/marked/lib/marked.esm.js&quot;;
proc_htmx('.marked', e => e.innerHTML = marked.parse(e.textContent));</script>     <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/styles/atom-one-dark.css&quot; media=&quot;(prefers-color-scheme: dark)&quot;>
     <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/styles/atom-one-light.css&quot; media=&quot;(prefers-color-scheme: light)&quot;>
<script src=&quot;https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/highlight.min.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/gh/arronhunt/highlightjs-copy/dist/highlightjs-copy.min.js&quot;></script>     <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/arronhunt/highlightjs-copy/dist/highlightjs-copy.min.css&quot;>
<script src=&quot;https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/languages/python.min.js&quot;></script><script type=&quot;module&quot;>
hljs.addPlugin(new CopyButtonPlugin());
hljs.configure({'cssSelector': 'pre code:not([data-highlighted=&quot;yes&quot;])'});
htmx.onLoad(hljs.highlightAll);</script><script>
    function sendmsg() {
        window.parent.postMessage({height: document.documentElement.offsetHeight}, '*');
    }
    window.onload = function() {
        sendmsg();
        document.body.addEventListener('htmx:afterSettle',    sendmsg);
        document.body.addEventListener('htmx:wsAfterMessage', sendmsg);
    };</script>   </head>
   <body>
<button type=&quot;submit&quot; class=&quot;btn &quot;>提交</button>   </body>
 </html>
" style="width: 100%; height: auto; border: none;" onload="{
        let frame = this;
        window.addEventListener('message', function(e) {
            if (e.source !== frame.contentWindow) return; // Only proceed if the message is from this iframe
            if (e.data.height) frame.style.height = (e.data.height+1) + 'px';
        }, false);
    }" allow="accelerometer; autoplay; camera; clipboard-read; clipboard-write; display-capture; encrypted-media; fullscreen; gamepad; geolocation; gyroscope; hid; identity-credentials-get; idle-detection; magnetometer; microphone; midi; payment; picture-in-picture; publickey-credentials-get; screen-wake-lock; serial; usb; web-share; xr-spatial-tracking"></iframe> 
</div>
</div>
</section>
<section id="route-helper-functions" class="level3">
<h3 class="anchored" data-anchor-id="route-helper-functions">Route Helper Functions</h3>
<p>Helper functions for managing chat sessions and rendering responses. <code>get_chat</code> retrieves the active chat and shell for the current user’s dialog. <code>sync_hist</code> persists the conversation history to the database. <code>mk_reply</code> generates the UI response—a pair of bubbles (user input and model output) along with an OOB swap to clear the input field.</p>
<div id="d3c8d251" class="cell" data-time_run="2026-01-22T00:34:01.712683+00:00">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb65" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>user_chats</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="0">
<pre data-code-line-numbers=""><code>{(1, 1): (&lt;lisette.core.Chat at 0x70ee1a6efda0&gt;,
  &lt;IPython.terminal.interactiveshell.TerminalInteractiveShell at 0x70ee225f31a0&gt;)}</code></pre>
</div>
</div>
<div id="ca673239" class="cell" data-time_run="2026-01-22T00:34:01.717199+00:00">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb67" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>fake_session <span class="op">=</span> {<span class="st">'userid'</span>:<span class="dv">1</span>, <span class="st">'current_dialog'</span>:<span class="dv">1</span>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>::: {#7eba2cc7 .cell 0=‘e’ 1=‘x’ 2=‘p’ 3=‘o’ 4=‘r’ 5=‘t’ time_run=‘2026-01-22T00:34:01.725230+00:00’}</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb68" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_chat(session): <span class="cf">return</span> user_chats[(session[<span class="st">'userid'</span>], session[<span class="st">'current_dialog'</span>])]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>:::</p>
<div id="cdf98500" class="cell" data-time_run="2026-01-22T00:34:01.729644+00:00">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb69" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>get_chat(fake_session)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="0">
<pre data-code-line-numbers=""><code>(&lt;lisette.core.Chat at 0x70ee1a6efda0&gt;,
 &lt;IPython.terminal.interactiveshell.TerminalInteractiveShell at 0x70ee225f31a0&gt;)</code></pre>
</div>
</div>
<p>::: {#649b261d .cell 0=‘e’ 1=‘x’ 2=‘p’ 3=‘o’ 4=‘r’ 5=‘t’ time_run=‘2026-01-22T00:34:01.734433+00:00’}</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb71" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> sync_hist(session, hist): dialogs.update(uid<span class="op">=</span>session[<span class="st">'userid'</span>], dialog_num<span class="op">=</span>session[<span class="st">'current_dialog'</span>], messages<span class="op">=</span>json.dumps([h.model_dump() <span class="cf">if</span> <span class="bu">hasattr</span>(h, <span class="st">'model_dump'</span>) <span class="cf">else</span> h <span class="cf">for</span> h <span class="kw">in</span> hist]))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>:::</p>
<div id="d862c7c5" class="cell" data-time_run="2026-01-22T00:34:01.741455+00:00">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb72" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>c <span class="op">=</span> Chat(<span class="st">'moonshot/kimi-k2-0711-preview'</span>, sp<span class="op">=</span>sp)</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>c(<span class="st">'你是谁？'</span>)<span class="op">;</span> c.hist</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="0">
<pre data-code-line-numbers=""><code>[{'role': 'user', 'content': '你是谁？'},
 Message(content='我是Kimi，由月之暗面科技有限公司训练的大语言模型。很高兴为你提供帮助！', role='assistant', tool_calls=None, function_call=None, provider_specific_fields={'refusal': None})]</code></pre>
</div>
</div>
<div id="3bdc4051" class="cell" data-time_run="2026-01-22T00:34:02.706286+00:00">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb74" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>sync_hist(fake_session, c.hist)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="1fd1880e" class="cell" data-time_run="2026-01-22T00:34:02.711896+00:00">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb75" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>json.loads(dialogs[(<span class="dv">1</span>, <span class="dv">1</span>)].messages)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="0">
<pre data-code-line-numbers=""><code>[{'role': 'user', 'content': '你是谁？'},
 {'content': '我是Kimi，由月之暗面科技有限公司训练的大语言模型。很高兴为你提供帮助！',
  'role': 'assistant',
  'tool_calls': None,
  'function_call': None,
  'provider_specific_fields': {'refusal': None}}]</code></pre>
</div>
</div>
<p>::: {#c862e101 .cell 0=‘e’ 1=‘x’ 2=‘p’ 3=‘o’ 4=‘r’ 5=‘t’ time_run=‘2026-01-22T00:34:02.717276+00:00’}</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb77" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> mk_reply(inp, out, color, name<span class="op">=</span><span class="st">'inp'</span>, placeholder<span class="op">=</span><span class="st">'输入内容···'</span>): <span class="cf">return</span> Inp(oob<span class="op">=</span><span class="va">True</span>, name<span class="op">=</span>name, placeholder<span class="op">=</span>placeholder, onkeydown<span class="op">=</span><span class="st">"if(event.shiftKey &amp;&amp; event.key==='Enter') { event.preventDefault(); this.form.requestSubmit(); }"</span>), Div(cls<span class="op">=</span><span class="st">'space-y-0.5'</span>)(</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>    Bubble(inp, color), </span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>    Bubble(out, color, <span class="st">'r'</span>) <span class="cf">if</span> out <span class="cf">else</span> <span class="va">None</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>:::</p>
<div id="f03287fe" class="cell" data-time_run="2026-01-22T00:34:02.722413+00:00">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb78" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>prev(mk_reply(<span class="st">'呵呵'</span>, <span class="st">'哈哈'</span>, <span class="st">'prompt'</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="0">
<iframe srcdoc=" <!doctype html>
 <html>
   <head>
     <title>FastHTML page</title>
     <link rel=&quot;canonical&quot; href=&quot;https://testserver/_2pjxXAnyTr6szUdiW_Ismw&quot;>
     <meta charset=&quot;utf-8&quot;>
     <meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1, viewport-fit=cover&quot;>
<script src=&quot;https://cdn.jsdelivr.net/npm/htmx.org@2.0.7/dist/htmx.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/gh/answerdotai/fasthtml-js@1.0.12/fasthtml.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/gh/answerdotai/surreal@main/surreal.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/gh/gnat/css-scope-inline@main/script.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4&quot;></script>     <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/basecoat-css@0.3.6/dist/basecoat.cdn.min.css&quot;>
<script src=&quot;https://cdn.jsdelivr.net/npm/basecoat-css@0.3.6/dist/js/all.min.js&quot; defer></script><script type=&quot;module&quot;>import { marked } from &quot;https://cdn.jsdelivr.net/npm/marked/lib/marked.esm.js&quot;;
proc_htmx('.marked', e => e.innerHTML = marked.parse(e.textContent));</script>     <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/styles/atom-one-dark.css&quot; media=&quot;(prefers-color-scheme: dark)&quot;>
     <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/styles/atom-one-light.css&quot; media=&quot;(prefers-color-scheme: light)&quot;>
<script src=&quot;https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/highlight.min.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/gh/arronhunt/highlightjs-copy/dist/highlightjs-copy.min.js&quot;></script>     <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/arronhunt/highlightjs-copy/dist/highlightjs-copy.min.css&quot;>
<script src=&quot;https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/languages/python.min.js&quot;></script><script type=&quot;module&quot;>
hljs.addPlugin(new CopyButtonPlugin());
hljs.configure({'cssSelector': 'pre code:not([data-highlighted=&quot;yes&quot;])'});
htmx.onLoad(hljs.highlightAll);</script><script>
    function sendmsg() {
        window.parent.postMessage({height: document.documentElement.offsetHeight}, '*');
    }
    window.onload = function() {
        sendmsg();
        document.body.addEventListener('htmx:afterSettle',    sendmsg);
        document.body.addEventListener('htmx:wsAfterMessage', sendmsg);
    };</script>   </head>
   <body>
<textarea type=&quot;text&quot; rows=&quot;1&quot; placeholder=&quot;输入内容···&quot; hx-swap-oob=&quot;true&quot; name=&quot;inp&quot; onkeydown=&quot;if(event.shiftKey &amp;amp;&amp;amp; event.key==='Enter') { event.preventDefault(); this.form.requestSubmit(); }&quot; id=&quot;inp&quot; class=&quot;textarea font-mono&quot;></textarea>     <div class=&quot;space-y-0.5&quot;>
       <div class=&quot;marked  flex w-max max-w-[75%] flex-col gap-2 rounded-lg px-3 py-2 text-sm border-2 border-red-500 bg-red-50&quot;>呵呵</div>
       <div class=&quot;marked ml-6 flex w-max max-w-[75%] flex-col gap-2 rounded-lg px-3 py-2 text-sm border-2 border-red-500 bg-red-50&quot;>哈哈</div>
     </div>
   </body>
 </html>
" style="width: 100%; height: auto; border: none;" onload="{
        let frame = this;
        window.addEventListener('message', function(e) {
            if (e.source !== frame.contentWindow) return; // Only proceed if the message is from this iframe
            if (e.data.height) frame.style.height = (e.data.height+1) + 'px';
        }, false);
    }" allow="accelerometer; autoplay; camera; clipboard-read; clipboard-write; display-capture; encrypted-media; fullscreen; gamepad; geolocation; gyroscope; hid; identity-credentials-get; idle-detection; magnetometer; microphone; midi; payment; picture-in-picture; publickey-credentials-get; screen-wake-lock; serial; usb; web-share; xr-spatial-tracking"></iframe> 
</div>
</div>
</section>
<section id="llm-route" class="level3">
<h3 class="anchored" data-anchor-id="llm-route">LLM Route</h3>
<div id="f512daec" class="cell" data-time_run="2026-01-22T00:34:02.733558+00:00">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb79" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> c(<span class="st">'嗨'</span>)<span class="op">;</span> r.choices[<span class="dv">0</span>].message.content</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="0">
<pre data-code-line-numbers=""><code>'嗨！有什么我可以帮你的吗？'</code></pre>
</div>
</div>
<p>::: {#744b0ef0 .cell 0=‘e’ 1=‘x’ 2=‘p’ 3=‘o’ 4=‘r’ 5=‘t’ time_run=‘2026-01-22T00:34:03.555060+00:00’}</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb81" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> add_hist(hist, <span class="bu">type</span>, content<span class="op">=</span><span class="st">''</span>, role<span class="op">=</span><span class="st">'user'</span>):</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>    hist.append(<span class="bu">dict</span>(role<span class="op">=</span>role, content<span class="op">=</span>content, <span class="bu">type</span><span class="op">=</span><span class="bu">type</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>:::</p>
<p>I’ve added a <code>type</code> key to allow me to know in what style to render the message (blue for <code>'code'</code>, red for <code>'prompt'</code>, and green for <code>'note'</code>) when I load them.</p>
<div id="6155227b" class="cell" data-time_run="2026-01-22T00:34:03.559630+00:00">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb82" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>add_hist(c.hist, <span class="st">'note'</span>, content<span class="op">=</span><span class="st">'这只是一张便条'</span>)</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>c.hist</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="0">
<pre data-code-line-numbers=""><code>[{'role': 'user', 'content': '你是谁？'},
 Message(content='我是Kimi，由月之暗面科技有限公司训练的大语言模型。很高兴为你提供帮助！', role='assistant', tool_calls=None, function_call=None, provider_specific_fields={'refusal': None}),
 {'role': 'user', 'content': '嗨'},
 Message(content='嗨！有什么我可以帮你的吗？', role='assistant', tool_calls=None, function_call=None, provider_specific_fields={'refusal': None}),
 {'role': 'user', 'content': '这只是一张便条', 'type': 'note'}]</code></pre>
</div>
</div>
<p>::: {#e8fb36a9 .cell 0=‘e’ 1=‘x’ 2=‘p’ 3=‘o’ 4=‘r’ 5=‘t’ time_run=‘2026-01-22T00:34:03.565395+00:00’}</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb84" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="at">@rt</span></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> ask_llm(qry:<span class="bu">str</span>, session):</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>    c,sh <span class="op">=</span> get_chat(session)</span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>    res <span class="op">=</span> c(qry)</span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>    content <span class="op">=</span> res.choices[<span class="dv">0</span>].message.content</span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>    c.hist[<span class="op">-</span><span class="dv">2</span>][<span class="st">'type'</span>] <span class="op">=</span> <span class="st">'prompt'</span></span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>    c.hist[<span class="op">-</span><span class="dv">1</span>][<span class="st">'type'</span>] <span class="op">=</span> <span class="st">'prompt'</span></span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>    sync_hist(session, c.hist)</span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> mk_reply(qry, content, <span class="st">'prompt'</span>, <span class="st">'qry'</span>, t(<span class="st">'ask_model'</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>:::</p>
<div id="0903d3d5" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb85" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>prev(<span class="st">'/ask_llm?qry=你好'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p><img src="../images/31_solveit_in_solveit/2.png" class="img-fluid"></p>
<p><code>ask_llm</code>, alongside quering the model, stores the conversation with a <code>type</code> marker for rendering and syncs the history to the database.</p>
<p>::: {#a3bcde66 .cell 0=‘e’ 1=‘x’ 2=‘p’ 3=‘o’ 4=‘r’ 5=‘t’ time_run=‘2026-01-22T00:34:03.574612+00:00’}</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb86" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test(inp):</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> Div(Div(<span class="bu">id</span><span class="op">=</span><span class="st">'msgs'</span>),</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>    Form(hx_post<span class="op">=</span>ask_llm, hx_target<span class="op">=</span><span class="st">'#msgs'</span>, hx_swap<span class="op">=</span><span class="st">'beforeend'</span>, cls<span class="op">=</span><span class="st">'flex items-center space-x-2'</span>)(inp, Button(<span class="st">'提交'</span>, <span class="bu">type</span><span class="op">=</span><span class="st">'submit'</span>)))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>:::</p>
<div id="d4a24dcc" class="cell" data-time_run="2026-01-22T00:34:03.580061+00:00">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb87" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>prev(test(Inp(<span class="bu">id</span><span class="op">=</span><span class="st">'qry'</span>)))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="0">
<iframe srcdoc=" <!doctype html>
 <html>
   <head>
     <title>FastHTML page</title>
     <link rel=&quot;canonical&quot; href=&quot;https://testserver/_sOwJPhU5QG2fgQZgOB898g&quot;>
     <meta charset=&quot;utf-8&quot;>
     <meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1, viewport-fit=cover&quot;>
<script src=&quot;https://cdn.jsdelivr.net/npm/htmx.org@2.0.7/dist/htmx.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/gh/answerdotai/fasthtml-js@1.0.12/fasthtml.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/gh/answerdotai/surreal@main/surreal.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/gh/gnat/css-scope-inline@main/script.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4&quot;></script>     <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/basecoat-css@0.3.6/dist/basecoat.cdn.min.css&quot;>
<script src=&quot;https://cdn.jsdelivr.net/npm/basecoat-css@0.3.6/dist/js/all.min.js&quot; defer></script><script type=&quot;module&quot;>import { marked } from &quot;https://cdn.jsdelivr.net/npm/marked/lib/marked.esm.js&quot;;
proc_htmx('.marked', e => e.innerHTML = marked.parse(e.textContent));</script>     <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/styles/atom-one-dark.css&quot; media=&quot;(prefers-color-scheme: dark)&quot;>
     <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/styles/atom-one-light.css&quot; media=&quot;(prefers-color-scheme: light)&quot;>
<script src=&quot;https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/highlight.min.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/gh/arronhunt/highlightjs-copy/dist/highlightjs-copy.min.js&quot;></script>     <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/arronhunt/highlightjs-copy/dist/highlightjs-copy.min.css&quot;>
<script src=&quot;https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/languages/python.min.js&quot;></script><script type=&quot;module&quot;>
hljs.addPlugin(new CopyButtonPlugin());
hljs.configure({'cssSelector': 'pre code:not([data-highlighted=&quot;yes&quot;])'});
htmx.onLoad(hljs.highlightAll);</script><script>
    function sendmsg() {
        window.parent.postMessage({height: document.documentElement.offsetHeight}, '*');
    }
    window.onload = function() {
        sendmsg();
        document.body.addEventListener('htmx:afterSettle',    sendmsg);
        document.body.addEventListener('htmx:wsAfterMessage', sendmsg);
    };</script>   </head>
   <body>
     <div>
       <div id=&quot;msgs&quot;></div>
<form hx-post=&quot;/ask_llm&quot; hx-target=&quot;#msgs&quot; hx-swap=&quot;beforeend&quot; class=&quot;flex items-center space-x-2&quot;><textarea type=&quot;text&quot; rows=&quot;1&quot; placeholder=&quot;输入内容···&quot; id=&quot;qry&quot; class=&quot;textarea font-mono&quot; name=&quot;qry&quot;></textarea><button type=&quot;submit&quot; class=&quot;btn &quot;>提交</button></form>     </div>
   </body>
 </html>
" style="width: 100%; height: auto; border: none;" onload="{
        let frame = this;
        window.addEventListener('message', function(e) {
            if (e.source !== frame.contentWindow) return; // Only proceed if the message is from this iframe
            if (e.data.height) frame.style.height = (e.data.height+1) + 'px';
        }, false);
    }" allow="accelerometer; autoplay; camera; clipboard-read; clipboard-write; display-capture; encrypted-media; fullscreen; gamepad; geolocation; gyroscope; hid; identity-credentials-get; idle-detection; magnetometer; microphone; midi; payment; picture-in-picture; publickey-credentials-get; screen-wake-lock; serial; usb; web-share; xr-spatial-tracking"></iframe> 
</div>
</div>
<div id="883fbfc1" class="cell" data-time_run="2026-01-22T00:34:20.304244+00:00">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb88" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>user_chats</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="0">
<pre data-code-line-numbers=""><code>{(1, 1): (&lt;lisette.core.Chat at 0x70ee1a6efda0&gt;,
  &lt;IPython.terminal.interactiveshell.TerminalInteractiveShell at 0x70ee225f31a0&gt;)}</code></pre>
</div>
</div>
</section>
<section id="code-route" class="level3">
<h3 class="anchored" data-anchor-id="code-route">Code Route</h3>
<div id="76deb6dd" class="cell" data-time_run="2026-01-22T00:34:21.390093+00:00">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb90" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>sh <span class="op">=</span> get_shell()<span class="op">;</span> sh</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="0">
<pre data-code-line-numbers=""><code>&lt;IPython.terminal.interactiveshell.TerminalInteractiveShell at 0x70ee190c31d0&gt;</code></pre>
</div>
</div>
<div id="a087eec5" class="cell" data-time_run="2026-01-22T00:34:21.967822+00:00">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb92" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>??get_shell</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display cell-output-markdown">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb93" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_shell()<span class="op">-&gt;</span>TerminalInteractiveShell:</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"Get a `TerminalInteractiveShell` with minimal functionality"</span></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>    sh <span class="op">=</span> TerminalInteractiveShell()</span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>    sh.logger.log_output <span class="op">=</span> sh.history_manager.enabled <span class="op">=</span> <span class="va">False</span></span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>    dh <span class="op">=</span> sh.displayhook</span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>    dh.finish_displayhook <span class="op">=</span> dh.write_output_prompt <span class="op">=</span> dh.start_displayhook <span class="op">=</span> <span class="kw">lambda</span>: <span class="va">None</span></span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>    dh.write_format_data <span class="op">=</span> <span class="kw">lambda</span> format_dict, md_dict<span class="op">=</span><span class="va">None</span>: <span class="va">None</span></span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a>    sh.logstart <span class="op">=</span> sh.automagic <span class="op">=</span> sh.autoindent <span class="op">=</span> <span class="va">False</span></span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a>    sh.autocall <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a>    sh.system <span class="op">=</span> <span class="kw">lambda</span> cmd: <span class="va">None</span></span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> sh</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>File:</strong> <code>/usr/local/lib/python3.12/site-packages/toolslm/shell.py</code></p>
</div>
</div>
<p><code>get_shell</code> relies on IPython under the hood.</p>
<p>::: {#0f20abdc .cell 0=‘e’ 1=‘x’ 2=‘p’ 3=‘o’ 4=‘r’ 5=‘t’ time_run=‘2026-01-22T00:34:23.268921+00:00’}</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb94" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> ex(code, sh):</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>    res <span class="op">=</span> sh.run_cell(code)</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> res.result <span class="cf">if</span> res.result <span class="cf">else</span> res.stdout</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>:::</p>
<p>::: {#3cd307bc .cell 0=‘e’ 1=‘x’ 2=‘p’ 3=‘o’ 4=‘r’ 5=‘t’ time_run=‘2026-01-22T00:34:23.654002+00:00’}</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb95" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="at">@rt</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> ex_code(code:<span class="bu">str</span>, session):</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>    c,sh <span class="op">=</span> get_chat(session)</span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>    add_hist(c.hist, <span class="st">'code'</span>, <span class="ss">f'[INTERPRETER INPUT]</span><span class="ch">\n</span><span class="ss">```py</span><span class="ch">\n</span><span class="sc">{</span>code<span class="sc">}</span><span class="ch">\n</span><span class="ss">```'</span>)</span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>    res <span class="op">=</span> ex(code, sh)</span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>    add_hist(c.hist, <span class="st">'code'</span>, <span class="ss">f'[INTERPRETER OUTPUT]</span><span class="ch">\n</span><span class="ss">```py</span><span class="ch">\n</span><span class="sc">{</span>res<span class="sc">}</span><span class="ch">\n</span><span class="ss">```'</span>, role<span class="op">=</span><span class="st">'assistant'</span>)</span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a>    sync_hist(session, c.hist)</span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> mk_reply(inp<span class="op">=</span><span class="ss">f'```py</span><span class="ch">\n</span><span class="sc">{</span>code<span class="sc">}</span><span class="ch">\n</span><span class="ss">```'</span>, out<span class="op">=</span> <span class="ss">f'```py</span><span class="ch">\n</span><span class="sc">{</span>res<span class="sc">}</span><span class="ch">\n</span><span class="ss">```'</span>, color<span class="op">=</span><span class="st">'code'</span>, name<span class="op">=</span><span class="st">'code'</span>, placeholder<span class="op">=</span>t(<span class="st">'your_code'</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>:::</p>
<p><code>ex_code</code> similarly also stores the conversation with a <code>type</code> marker and syncs with the database. A special <code>'[INTERPRETER INPUT/OUTPUT]'</code> marker is also added as indicators for the LLM.</p>
<div id="db08322b" class="cell" data-time_run="2026-01-22T00:34:24.700819+00:00">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb96" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>prev(Div(</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>    Div(<span class="bu">id</span><span class="op">=</span><span class="st">'msgs'</span>),</span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>    Form(hx_post<span class="op">=</span>ex_code, hx_target<span class="op">=</span><span class="st">'#msgs'</span>, hx_swap<span class="op">=</span><span class="st">'beforeend'</span>, cls<span class="op">=</span><span class="st">'flex items-center space-x-2'</span>)(Inp(name<span class="op">=</span><span class="st">'code'</span>), Button(<span class="st">'提交'</span>, <span class="bu">type</span><span class="op">=</span><span class="st">'submit'</span>))</span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="0">
<iframe srcdoc=" <!doctype html>
 <html>
   <head>
     <title>FastHTML page</title>
     <link rel=&quot;canonical&quot; href=&quot;https://testserver/_gpzn5PagQLu_sL3pcQnBjA&quot;>
     <meta charset=&quot;utf-8&quot;>
     <meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1, viewport-fit=cover&quot;>
<script src=&quot;https://cdn.jsdelivr.net/npm/htmx.org@2.0.7/dist/htmx.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/gh/answerdotai/fasthtml-js@1.0.12/fasthtml.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/gh/answerdotai/surreal@main/surreal.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/gh/gnat/css-scope-inline@main/script.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4&quot;></script>     <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/basecoat-css@0.3.6/dist/basecoat.cdn.min.css&quot;>
<script src=&quot;https://cdn.jsdelivr.net/npm/basecoat-css@0.3.6/dist/js/all.min.js&quot; defer></script><script type=&quot;module&quot;>import { marked } from &quot;https://cdn.jsdelivr.net/npm/marked/lib/marked.esm.js&quot;;
proc_htmx('.marked', e => e.innerHTML = marked.parse(e.textContent));</script>     <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/styles/atom-one-dark.css&quot; media=&quot;(prefers-color-scheme: dark)&quot;>
     <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/styles/atom-one-light.css&quot; media=&quot;(prefers-color-scheme: light)&quot;>
<script src=&quot;https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/highlight.min.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/gh/arronhunt/highlightjs-copy/dist/highlightjs-copy.min.js&quot;></script>     <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/arronhunt/highlightjs-copy/dist/highlightjs-copy.min.css&quot;>
<script src=&quot;https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/languages/python.min.js&quot;></script><script type=&quot;module&quot;>
hljs.addPlugin(new CopyButtonPlugin());
hljs.configure({'cssSelector': 'pre code:not([data-highlighted=&quot;yes&quot;])'});
htmx.onLoad(hljs.highlightAll);</script><script>
    function sendmsg() {
        window.parent.postMessage({height: document.documentElement.offsetHeight}, '*');
    }
    window.onload = function() {
        sendmsg();
        document.body.addEventListener('htmx:afterSettle',    sendmsg);
        document.body.addEventListener('htmx:wsAfterMessage', sendmsg);
    };</script>   </head>
   <body>
     <div>
       <div id=&quot;msgs&quot;></div>
<form hx-post=&quot;/ex_code&quot; hx-target=&quot;#msgs&quot; hx-swap=&quot;beforeend&quot; class=&quot;flex items-center space-x-2&quot;><textarea type=&quot;text&quot; rows=&quot;1&quot; placeholder=&quot;输入内容···&quot; name=&quot;code&quot; id=&quot;inp&quot; class=&quot;textarea font-mono&quot;></textarea><button type=&quot;submit&quot; class=&quot;btn &quot;>提交</button></form>     </div>
   </body>
 </html>
" style="width: 100%; height: auto; border: none;" onload="{
        let frame = this;
        window.addEventListener('message', function(e) {
            if (e.source !== frame.contentWindow) return; // Only proceed if the message is from this iframe
            if (e.data.height) frame.style.height = (e.data.height+1) + 'px';
        }, false);
    }" allow="accelerometer; autoplay; camera; clipboard-read; clipboard-write; display-capture; encrypted-media; fullscreen; gamepad; geolocation; gyroscope; hid; identity-credentials-get; idle-detection; magnetometer; microphone; midi; payment; picture-in-picture; publickey-credentials-get; screen-wake-lock; serial; usb; web-share; xr-spatial-tracking"></iframe> 
</div>
</div>
</section>
<section id="note-route" class="level3">
<h3 class="anchored" data-anchor-id="note-route">Note Route</h3>
<p>::: {#a591691c .cell 0=‘e’ 1=‘x’ 2=‘p’ 3=‘o’ 4=‘r’ 5=‘t’ time_run=‘2026-01-22T00:34:34.562110+00:00’}</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb97" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="at">@rt</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> add_note(note:<span class="bu">str</span>, session):</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>    c,sh <span class="op">=</span> get_chat(session)</span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>    add_hist(c.hist, <span class="st">'note'</span>, content<span class="op">=</span>note,)</span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>    sync_hist(session, c.hist)</span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> mk_reply(note, <span class="st">''</span>, <span class="st">'note'</span>, <span class="st">'note'</span>, t(<span class="st">'any_thoughts'</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>:::</p>
<div id="97613b2b" class="cell" data-time_run="2026-01-22T00:34:35.127191+00:00">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb98" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test(inp):</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> Div(Div(<span class="bu">id</span><span class="op">=</span><span class="st">'msgs'</span>),</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>    Form(hx_post<span class="op">=</span>add_note, hx_target<span class="op">=</span><span class="st">'#msgs'</span>, hx_swap<span class="op">=</span><span class="st">'beforeend'</span>, cls<span class="op">=</span><span class="st">'flex items-center space-x-2'</span>)(inp, Button(<span class="st">'提交'</span>, <span class="bu">type</span><span class="op">=</span><span class="st">'submit'</span>)))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="87d1a55b" class="cell" data-time_run="2026-01-22T00:34:36.919785+00:00">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb99" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>prev(test(Inp(<span class="bu">id</span><span class="op">=</span><span class="st">'note'</span>)))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="0">
<iframe srcdoc=" <!doctype html>
 <html>
   <head>
     <title>FastHTML page</title>
     <link rel=&quot;canonical&quot; href=&quot;https://testserver/_VCXLYIKUQ729Sx7Bs_EvCw&quot;>
     <meta charset=&quot;utf-8&quot;>
     <meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1, viewport-fit=cover&quot;>
<script src=&quot;https://cdn.jsdelivr.net/npm/htmx.org@2.0.7/dist/htmx.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/gh/answerdotai/fasthtml-js@1.0.12/fasthtml.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/gh/answerdotai/surreal@main/surreal.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/gh/gnat/css-scope-inline@main/script.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4&quot;></script>     <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/basecoat-css@0.3.6/dist/basecoat.cdn.min.css&quot;>
<script src=&quot;https://cdn.jsdelivr.net/npm/basecoat-css@0.3.6/dist/js/all.min.js&quot; defer></script><script type=&quot;module&quot;>import { marked } from &quot;https://cdn.jsdelivr.net/npm/marked/lib/marked.esm.js&quot;;
proc_htmx('.marked', e => e.innerHTML = marked.parse(e.textContent));</script>     <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/styles/atom-one-dark.css&quot; media=&quot;(prefers-color-scheme: dark)&quot;>
     <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/styles/atom-one-light.css&quot; media=&quot;(prefers-color-scheme: light)&quot;>
<script src=&quot;https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/highlight.min.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/gh/arronhunt/highlightjs-copy/dist/highlightjs-copy.min.js&quot;></script>     <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/arronhunt/highlightjs-copy/dist/highlightjs-copy.min.css&quot;>
<script src=&quot;https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/languages/python.min.js&quot;></script><script type=&quot;module&quot;>
hljs.addPlugin(new CopyButtonPlugin());
hljs.configure({'cssSelector': 'pre code:not([data-highlighted=&quot;yes&quot;])'});
htmx.onLoad(hljs.highlightAll);</script><script>
    function sendmsg() {
        window.parent.postMessage({height: document.documentElement.offsetHeight}, '*');
    }
    window.onload = function() {
        sendmsg();
        document.body.addEventListener('htmx:afterSettle',    sendmsg);
        document.body.addEventListener('htmx:wsAfterMessage', sendmsg);
    };</script>   </head>
   <body>
     <div>
       <div id=&quot;msgs&quot;></div>
<form hx-post=&quot;/add_note&quot; hx-target=&quot;#msgs&quot; hx-swap=&quot;beforeend&quot; class=&quot;flex items-center space-x-2&quot;><textarea type=&quot;text&quot; rows=&quot;1&quot; placeholder=&quot;输入内容···&quot; id=&quot;note&quot; class=&quot;textarea font-mono&quot; name=&quot;note&quot;></textarea><button type=&quot;submit&quot; class=&quot;btn &quot;>提交</button></form>     </div>
   </body>
 </html>
" style="width: 100%; height: auto; border: none;" onload="{
        let frame = this;
        window.addEventListener('message', function(e) {
            if (e.source !== frame.contentWindow) return; // Only proceed if the message is from this iframe
            if (e.data.height) frame.style.height = (e.data.height+1) + 'px';
        }, false);
    }" allow="accelerometer; autoplay; camera; clipboard-read; clipboard-write; display-capture; encrypted-media; fullscreen; gamepad; geolocation; gyroscope; hid; identity-credentials-get; idle-detection; magnetometer; microphone; midi; payment; picture-in-picture; publickey-credentials-get; screen-wake-lock; serial; usb; web-share; xr-spatial-tracking"></iframe> 
</div>
</div>
</section>
<section id="editor-component" class="level3">
<h3 class="anchored" data-anchor-id="editor-component">Editor Component</h3>
<p>Three editor components for the different message types. Each editor is a form that posts to its corresponding route (ex_code, ask_llm, or add_note) and appends the result to the message area.</p>
<p>::: {#3da6f419 .cell 0=‘e’ 1=‘x’ 2=‘p’ 3=‘o’ 4=‘r’ 5=‘t’ time_run=‘2026-01-22T00:34:55.717291+00:00’}</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb100" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="at">@rt</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> code_editor(session): <span class="cf">return</span> Form(hx_post<span class="op">=</span>ex_code, hx_target<span class="op">=</span><span class="st">'#msgs'</span>, hx_swap<span class="op">=</span><span class="st">'beforeend'</span>, cls<span class="op">=</span><span class="st">'flex items-stretch space-x-2'</span>)(Inp(placeholder<span class="op">=</span>t(<span class="st">'enter_code'</span>, session), name<span class="op">=</span><span class="st">'code'</span>, onkeydown<span class="op">=</span><span class="st">"if(event.shiftKey &amp;&amp; event.key==='Enter') { event.preventDefault(); this.form.requestSubmit(); }"</span>), Button(t(<span class="st">'submit'</span>, session), <span class="bu">type</span><span class="op">=</span><span class="st">'submit'</span>, cls<span class="op">=</span><span class="st">'self-stretch h-auto'</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>:::</p>
<p>The editor routes need the session cookie for translations because each editor is loaded in a separate request. Since <code>ContextVar</code> resets with each new request, we need to re-set the language from the session at the start of each request.</p>
<div id="ab710ded" class="cell" data-time_run="2026-01-22T00:34:57.364902+00:00">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb101" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>prev(Div(Div(<span class="bu">id</span><span class="op">=</span><span class="st">'msgs'</span>),Div(hx_get<span class="op">=</span>code_editor, hx_trigger<span class="op">=</span><span class="st">'load'</span>)))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="0">
<iframe srcdoc=" <!doctype html>
 <html>
   <head>
     <title>FastHTML page</title>
     <link rel=&quot;canonical&quot; href=&quot;https://testserver/_TP4ozbZ9R6im9-QhRIq3kw&quot;>
     <meta charset=&quot;utf-8&quot;>
     <meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1, viewport-fit=cover&quot;>
<script src=&quot;https://cdn.jsdelivr.net/npm/htmx.org@2.0.7/dist/htmx.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/gh/answerdotai/fasthtml-js@1.0.12/fasthtml.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/gh/answerdotai/surreal@main/surreal.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/gh/gnat/css-scope-inline@main/script.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4&quot;></script>     <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/basecoat-css@0.3.6/dist/basecoat.cdn.min.css&quot;>
<script src=&quot;https://cdn.jsdelivr.net/npm/basecoat-css@0.3.6/dist/js/all.min.js&quot; defer></script><script type=&quot;module&quot;>import { marked } from &quot;https://cdn.jsdelivr.net/npm/marked/lib/marked.esm.js&quot;;
proc_htmx('.marked', e => e.innerHTML = marked.parse(e.textContent));</script>     <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/styles/atom-one-dark.css&quot; media=&quot;(prefers-color-scheme: dark)&quot;>
     <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/styles/atom-one-light.css&quot; media=&quot;(prefers-color-scheme: light)&quot;>
<script src=&quot;https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/highlight.min.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/gh/arronhunt/highlightjs-copy/dist/highlightjs-copy.min.js&quot;></script>     <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/arronhunt/highlightjs-copy/dist/highlightjs-copy.min.css&quot;>
<script src=&quot;https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/languages/python.min.js&quot;></script><script type=&quot;module&quot;>
hljs.addPlugin(new CopyButtonPlugin());
hljs.configure({'cssSelector': 'pre code:not([data-highlighted=&quot;yes&quot;])'});
htmx.onLoad(hljs.highlightAll);</script><script>
    function sendmsg() {
        window.parent.postMessage({height: document.documentElement.offsetHeight}, '*');
    }
    window.onload = function() {
        sendmsg();
        document.body.addEventListener('htmx:afterSettle',    sendmsg);
        document.body.addEventListener('htmx:wsAfterMessage', sendmsg);
    };</script>   </head>
   <body>
     <div>
       <div id=&quot;msgs&quot;></div>
       <div hx-get=&quot;/code_editor&quot; hx-trigger=&quot;load&quot;></div>
     </div>
   </body>
 </html>
" style="width: 100%; height: auto; border: none;" onload="{
        let frame = this;
        window.addEventListener('message', function(e) {
            if (e.source !== frame.contentWindow) return; // Only proceed if the message is from this iframe
            if (e.data.height) frame.style.height = (e.data.height+1) + 'px';
        }, false);
    }" allow="accelerometer; autoplay; camera; clipboard-read; clipboard-write; display-capture; encrypted-media; fullscreen; gamepad; geolocation; gyroscope; hid; identity-credentials-get; idle-detection; magnetometer; microphone; midi; payment; picture-in-picture; publickey-credentials-get; screen-wake-lock; serial; usb; web-share; xr-spatial-tracking"></iframe> 
</div>
</div>
<p>::: {#e85cd35e .cell 0=‘e’ 1=‘x’ 2=‘p’ 3=‘o’ 4=‘r’ 5=‘t’ time_run=‘2026-01-22T00:35:18.553389+00:00’}</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb102" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="at">@rt</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> llm_editor(session): <span class="cf">return</span> Form(hx_post<span class="op">=</span>ask_llm, hx_target<span class="op">=</span><span class="st">'#msgs'</span>, hx_swap<span class="op">=</span><span class="st">'beforeend'</span>, cls<span class="op">=</span><span class="st">'flex items-center space-x-2'</span>)(Inp(placeholder<span class="op">=</span>t(<span class="st">'ask_model'</span>, session), name<span class="op">=</span><span class="st">'qry'</span>, onkeydown<span class="op">=</span><span class="st">"if(event.shiftKey &amp;&amp; event.key==='Enter') { event.preventDefault(); this.form.requestSubmit(); }"</span>), Button(t(<span class="st">'submit'</span>, session), <span class="bu">type</span><span class="op">=</span><span class="st">'submit'</span>, cls<span class="op">=</span><span class="st">'self-stretch h-auto'</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>:::</p>
<div id="84f3f0c8" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb103" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>prev(llm_editor)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p><img src="../images/31_solveit_in_solveit/3.png" class="img-fluid"></p>
<p>::: {#3f0d14d8 .cell 0=‘e’ 1=‘x’ 2=‘p’ 3=‘o’ 4=‘r’ 5=‘t’ time_run=‘2026-01-22T00:35:37.352665+00:00’}</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb104" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="at">@rt</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> note_editor(session): <span class="cf">return</span> Form(hx_post<span class="op">=</span>add_note, hx_target<span class="op">=</span><span class="st">'#msgs'</span>, hx_swap<span class="op">=</span><span class="st">'beforeend'</span>, cls<span class="op">=</span><span class="st">'flex items-center space-x-2'</span>)(Inp(placeholder<span class="op">=</span>t(<span class="st">'any_thoughts'</span>, session), name<span class="op">=</span><span class="st">'note'</span>, onkeydown<span class="op">=</span><span class="st">"if(event.shiftKey &amp;&amp; event.key==='Enter') { event.preventDefault(); this.form.requestSubmit(); }"</span>), Button(t(<span class="st">'submit'</span>, session), <span class="bu">type</span><span class="op">=</span><span class="st">'submit'</span>, cls<span class="op">=</span><span class="st">'self-stretch h-auto'</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>:::</p>
<div id="3ce84ce7" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb105" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>prev(note_editor)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="ae95e9e3" class="cell" data-time_run="2026-01-22T00:47:19.523133+00:00">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb106" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>[](..<span class="op">/</span>images<span class="op">/</span><span class="dv">31</span><span class="er">_solveit_in_solveit</span><span class="op">/</span><span class="fl">4.</span><span class="er">png</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code>/bin/bash: -c: line 1: syntax error near unexpected token `../images/31_solveit_in_solveit/4.png'
/bin/bash: -c: line 1: `[](../images/31_solveit_in_solveit/4.png)'</code></pre>
</div>
</div>
</section>
<section id="tabs" class="level3">
<h3 class="anchored" data-anchor-id="tabs">Tabs</h3>
<p>A tabbed navigation bar that lets users switch between the three editor types—code, prompt, and note. Each tab triggers an HTMX request to load the corresponding editor form into the editor container.</p>
<p>::: {#e2b96dec .cell 0=‘e’ 1=‘x’ 2=‘p’ 3=‘o’ 4=‘r’ 5=‘t’ time_run=‘2026-01-22T00:39:32.407645+00:00’}</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb108" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> Tab(title, <span class="bu">id</span>, hx_post, <span class="op">**</span>kwargs): <span class="cf">return</span> fc.Button(title, <span class="bu">id</span><span class="op">=</span><span class="ss">f'</span><span class="sc">{</span><span class="bu">id</span><span class="sc">}</span><span class="ss">-tab'</span>, <span class="bu">type</span><span class="op">=</span><span class="st">'button'</span>, role<span class="op">=</span><span class="st">'tab'</span>, hx_post<span class="op">=</span>hx_post, hx_target<span class="op">=</span><span class="st">'#editor'</span>, hx_swap<span class="op">=</span><span class="st">'innerHTML'</span>, <span class="op">**</span>kwargs)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>:::</p>
<div id="3d564e72" class="cell" data-time_run="2026-01-22T00:39:35.982976+00:00">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb109" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>prev(Nav(Tab(<span class="st">'标签'</span>, <span class="bu">id</span><span class="op">=</span><span class="st">'test'</span>, hx_post<span class="op">=</span><span class="va">None</span>), cls<span class="op">=</span><span class="st">'w-full'</span>, role<span class="op">=</span><span class="st">'tablist'</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="0">
<iframe srcdoc=" <!doctype html>
 <html>
   <head>
     <title>FastHTML page</title>
     <link rel=&quot;canonical&quot; href=&quot;https://testserver/_mALelgv5S2OwXq8-G3Ewxw&quot;>
     <meta charset=&quot;utf-8&quot;>
     <meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1, viewport-fit=cover&quot;>
<script src=&quot;https://cdn.jsdelivr.net/npm/htmx.org@2.0.7/dist/htmx.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/gh/answerdotai/fasthtml-js@1.0.12/fasthtml.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/gh/answerdotai/surreal@main/surreal.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/gh/gnat/css-scope-inline@main/script.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4&quot;></script>     <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/basecoat-css@0.3.6/dist/basecoat.cdn.min.css&quot;>
<script src=&quot;https://cdn.jsdelivr.net/npm/basecoat-css@0.3.6/dist/js/all.min.js&quot; defer></script><script type=&quot;module&quot;>import { marked } from &quot;https://cdn.jsdelivr.net/npm/marked/lib/marked.esm.js&quot;;
proc_htmx('.marked', e => e.innerHTML = marked.parse(e.textContent));</script>     <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/styles/atom-one-dark.css&quot; media=&quot;(prefers-color-scheme: dark)&quot;>
     <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/styles/atom-one-light.css&quot; media=&quot;(prefers-color-scheme: light)&quot;>
<script src=&quot;https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/highlight.min.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/gh/arronhunt/highlightjs-copy/dist/highlightjs-copy.min.js&quot;></script>     <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/arronhunt/highlightjs-copy/dist/highlightjs-copy.min.css&quot;>
<script src=&quot;https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/languages/python.min.js&quot;></script><script type=&quot;module&quot;>
hljs.addPlugin(new CopyButtonPlugin());
hljs.configure({'cssSelector': 'pre code:not([data-highlighted=&quot;yes&quot;])'});
htmx.onLoad(hljs.highlightAll);</script><script>
    function sendmsg() {
        window.parent.postMessage({height: document.documentElement.offsetHeight}, '*');
    }
    window.onload = function() {
        sendmsg();
        document.body.addEventListener('htmx:afterSettle',    sendmsg);
        document.body.addEventListener('htmx:wsAfterMessage', sendmsg);
    };</script>   </head>
   <body>
     <nav class=&quot;w-full&quot; role=&quot;tablist&quot;>
<button type=&quot;button&quot; role=&quot;tab&quot; hx-swap=&quot;innerHTML&quot; hx-target=&quot;#editor&quot; id=&quot;test-tab&quot; name=&quot;test-tab&quot;>标签</button>     </nav>
   </body>
 </html>
" style="width: 100%; height: auto; border: none;" onload="{
        let frame = this;
        window.addEventListener('message', function(e) {
            if (e.source !== frame.contentWindow) return; // Only proceed if the message is from this iframe
            if (e.data.height) frame.style.height = (e.data.height+1) + 'px';
        }, false);
    }" allow="accelerometer; autoplay; camera; clipboard-read; clipboard-write; display-capture; encrypted-media; fullscreen; gamepad; geolocation; gyroscope; hid; identity-credentials-get; idle-detection; magnetometer; microphone; midi; payment; picture-in-picture; publickey-credentials-get; screen-wake-lock; serial; usb; web-share; xr-spatial-tracking"></iframe> 
</div>
</div>
<p>::: {#355bf665 .cell 0=‘e’ 1=‘x’ 2=‘p’ 3=‘o’ 4=‘r’ 5=‘t’ time_run=‘2026-01-22T00:39:37.560871+00:00’}</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb110" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> TabBar(cls<span class="op">=</span><span class="st">''</span>, <span class="op">*</span>args, <span class="op">**</span>kwargs): </span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> Nav(</span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>        Tab(t(<span class="st">'code'</span>), <span class="bu">id</span><span class="op">=</span><span class="st">'code'</span>, hx_post<span class="op">=</span>code_editor),</span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a>        Tab(t(<span class="st">'prompt'</span>), <span class="bu">id</span><span class="op">=</span><span class="st">'qry'</span>, hx_post<span class="op">=</span>llm_editor),</span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a>        Tab(t(<span class="st">'note'</span>), <span class="bu">id</span><span class="op">=</span><span class="st">'note'</span>, hx_post<span class="op">=</span>note_editor),</span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a>        cls<span class="op">=</span><span class="ss">f'w-full </span><span class="sc">{</span>cls<span class="sc">}</span><span class="ss">'</span>, role<span class="op">=</span><span class="st">'tablist'</span>, <span class="op">*</span>args, <span class="op">**</span>kwargs</span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a>    )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>:::</p>
<div id="eb8c9010" class="cell" data-time_run="2026-01-22T00:39:39.897658+00:00">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb111" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>prev(Div(TabBar(), Div(<span class="bu">id</span><span class="op">=</span><span class="st">'editor'</span>), cls<span class="op">=</span><span class="st">'tabs w-full'</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="0">
<iframe srcdoc=" <!doctype html>
 <html>
   <head>
     <title>FastHTML page</title>
     <link rel=&quot;canonical&quot; href=&quot;https://testserver/_1osIrIiPS2_bxJ-sxvruzQ&quot;>
     <meta charset=&quot;utf-8&quot;>
     <meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1, viewport-fit=cover&quot;>
<script src=&quot;https://cdn.jsdelivr.net/npm/htmx.org@2.0.7/dist/htmx.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/gh/answerdotai/fasthtml-js@1.0.12/fasthtml.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/gh/answerdotai/surreal@main/surreal.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/gh/gnat/css-scope-inline@main/script.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4&quot;></script>     <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/basecoat-css@0.3.6/dist/basecoat.cdn.min.css&quot;>
<script src=&quot;https://cdn.jsdelivr.net/npm/basecoat-css@0.3.6/dist/js/all.min.js&quot; defer></script><script type=&quot;module&quot;>import { marked } from &quot;https://cdn.jsdelivr.net/npm/marked/lib/marked.esm.js&quot;;
proc_htmx('.marked', e => e.innerHTML = marked.parse(e.textContent));</script>     <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/styles/atom-one-dark.css&quot; media=&quot;(prefers-color-scheme: dark)&quot;>
     <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/styles/atom-one-light.css&quot; media=&quot;(prefers-color-scheme: light)&quot;>
<script src=&quot;https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/highlight.min.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/gh/arronhunt/highlightjs-copy/dist/highlightjs-copy.min.js&quot;></script>     <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/arronhunt/highlightjs-copy/dist/highlightjs-copy.min.css&quot;>
<script src=&quot;https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/languages/python.min.js&quot;></script><script type=&quot;module&quot;>
hljs.addPlugin(new CopyButtonPlugin());
hljs.configure({'cssSelector': 'pre code:not([data-highlighted=&quot;yes&quot;])'});
htmx.onLoad(hljs.highlightAll);</script><script>
    function sendmsg() {
        window.parent.postMessage({height: document.documentElement.offsetHeight}, '*');
    }
    window.onload = function() {
        sendmsg();
        document.body.addEventListener('htmx:afterSettle',    sendmsg);
        document.body.addEventListener('htmx:wsAfterMessage', sendmsg);
    };</script>   </head>
   <body>
     <div class=&quot;tabs w-full&quot;>
       <nav class=&quot;w-full &quot; role=&quot;tablist&quot;>
<button type=&quot;button&quot; role=&quot;tab&quot; hx-post=&quot;/code_editor&quot; hx-swap=&quot;innerHTML&quot; hx-target=&quot;#editor&quot; id=&quot;code-tab&quot; name=&quot;code-tab&quot;>Code</button><button type=&quot;button&quot; role=&quot;tab&quot; hx-post=&quot;/llm_editor&quot; hx-swap=&quot;innerHTML&quot; hx-target=&quot;#editor&quot; id=&quot;qry-tab&quot; name=&quot;qry-tab&quot;>Prompt</button><button type=&quot;button&quot; role=&quot;tab&quot; hx-post=&quot;/note_editor&quot; hx-swap=&quot;innerHTML&quot; hx-target=&quot;#editor&quot; id=&quot;note-tab&quot; name=&quot;note-tab&quot;>Note</button>       </nav>
       <div id=&quot;editor&quot;></div>
     </div>
   </body>
 </html>
" style="width: 100%; height: auto; border: none;" onload="{
        let frame = this;
        window.addEventListener('message', function(e) {
            if (e.source !== frame.contentWindow) return; // Only proceed if the message is from this iframe
            if (e.data.height) frame.style.height = (e.data.height+1) + 'px';
        }, false);
    }" allow="accelerometer; autoplay; camera; clipboard-read; clipboard-write; display-capture; encrypted-media; fullscreen; gamepad; geolocation; gyroscope; hid; identity-credentials-get; idle-detection; magnetometer; microphone; midi; payment; picture-in-picture; publickey-credentials-get; screen-wake-lock; serial; usb; web-share; xr-spatial-tracking"></iframe> 
</div>
</div>
</section>
<section id="render-existing-messages" class="level3">
<h3 class="anchored" data-anchor-id="render-existing-messages">Render Existing Messages</h3>
<p>::: {#764bf26a .cell 0=‘e’ 1=‘x’ 2=‘p’ 3=‘o’ 4=‘r’ 5=‘t’ time_run=‘2026-01-22T00:39:42.067948+00:00’}</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb112" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="at">@rt</span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> load_messages(session):</span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>    c,sh <span class="op">=</span> get_chat(session)</span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> c.hist:</span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a>        role <span class="op">=</span> i.get(<span class="st">'role'</span>) <span class="cf">if</span> <span class="bu">isinstance</span>(i, <span class="bu">dict</span>) <span class="cf">else</span> i.role</span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> role<span class="op">==</span><span class="st">'user'</span>:      <span class="cf">yield</span> Div(Bubble(i[<span class="st">'content'</span>].replace(<span class="st">'[INTERPRETER INPUT]</span><span class="ch">\n</span><span class="st">'</span>, <span class="st">''</span>), i[<span class="st">'type'</span>]), cls<span class="op">=</span><span class="st">'space-y-0.5'</span>)</span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> role<span class="op">==</span><span class="st">'assistant'</span>: <span class="cf">yield</span> Div(Bubble(i[<span class="st">'content'</span>].replace(<span class="st">'[INTERPRETER OUTPUT]</span><span class="ch">\n</span><span class="st">'</span>, <span class="st">''</span>), i[<span class="st">'type'</span>], <span class="st">'r'</span>), cls<span class="op">=</span><span class="st">'space-y-0.5'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>:::</p>
<div id="a3420fbb" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb113" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>prev(<span class="ss">f'/load_messages'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p><img src="../images/31_solveit_in_solveit/5.png" class="img-fluid"></p>
</section>
<section id="dialog" class="level3">
<h3 class="anchored" data-anchor-id="dialog">Dialog</h3>
<p>The dialog component ties everything together—a title bar that supports inline editing, a message display area that loads existing conversation history, and the tabbed editor for adding new messages. Clicking a dialog name makes it editable, and saving updates the database immediately.</p>
<p>::: {#64ce33d2 .cell 0=‘e’ 1=‘x’ 2=‘p’ 3=‘o’ 4=‘r’ 5=‘t’ time_run=‘2026-01-22T00:40:04.037914+00:00’}</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb114" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="at">@rt</span></span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> edit_dname(session):</span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>    dname <span class="op">=</span> dialogs[(session[<span class="st">'userid'</span>], session[<span class="st">'current_dialog'</span>])].name</span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> Form(<span class="bu">id</span><span class="op">=</span><span class="st">'dname'</span>, hx_post<span class="op">=</span>save_dname, hx_target<span class="op">=</span><span class="st">'#dname'</span>, hx_swap<span class="op">=</span><span class="st">'outerHTML'</span>)(</span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a>        Input(value<span class="op">=</span>dname, name<span class="op">=</span><span class="st">'newname'</span>, autofocus<span class="op">=</span><span class="va">True</span>, onfocus<span class="op">=</span><span class="st">'this.select()'</span>, required<span class="op">=</span><span class="va">True</span>, cls<span class="op">=</span><span class="st">'text-2xl font-bold outline-none'</span>),</span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a>        Button(t(<span class="st">'save'</span>, session), <span class="bu">type</span><span class="op">=</span><span class="st">'submit'</span>)</span>
<span id="cb114-7"><a href="#cb114-7" aria-hidden="true" tabindex="-1"></a>    )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>:::</p>
<p>::: {#9d6ae097 .cell 0=‘e’ 1=‘x’ 2=‘p’ 3=‘o’ 4=‘r’ 5=‘t’ time_run=‘2026-01-22T00:40:04.608020+00:00’}</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb115" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="at">@rt</span> </span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> save_dname(session, newname:<span class="bu">str</span>):</span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a>    dialogs.update(uid<span class="op">=</span>session[<span class="st">'userid'</span>], dialog_num<span class="op">=</span>session[<span class="st">'current_dialog'</span>], name<span class="op">=</span>newname)</span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> DialogTitle(newname)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>:::</p>
<p>::: {#dfb739b4 .cell 0=‘e’ 1=‘x’ 2=‘p’ 3=‘o’ 4=‘r’ 5=‘t’ time_run=‘2026-01-22T00:40:05.386759+00:00’}</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb116" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> DialogTitle(name): <span class="cf">return</span> H1(name, cls<span class="op">=</span><span class="st">'text-2xl font-bold'</span>, <span class="bu">id</span><span class="op">=</span><span class="st">'dname'</span>, hx_get<span class="op">=</span>edit_dname, hx_target<span class="op">=</span><span class="st">'#dname'</span>, hx_swap<span class="op">=</span><span class="st">'outerHTML'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>:::</p>
<div id="fb800175" class="cell" data-time_run="2026-01-22T00:40:09.509853+00:00">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb117" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>prev(DialogTitle(<span class="st">'对话'</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="0">
<iframe srcdoc=" <!doctype html>
 <html>
   <head>
     <title>FastHTML page</title>
     <link rel=&quot;canonical&quot; href=&quot;https://testserver/_k7gfueTcTcqBaOF87mC30w&quot;>
     <meta charset=&quot;utf-8&quot;>
     <meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1, viewport-fit=cover&quot;>
<script src=&quot;https://cdn.jsdelivr.net/npm/htmx.org@2.0.7/dist/htmx.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/gh/answerdotai/fasthtml-js@1.0.12/fasthtml.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/gh/answerdotai/surreal@main/surreal.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/gh/gnat/css-scope-inline@main/script.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4&quot;></script>     <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/basecoat-css@0.3.6/dist/basecoat.cdn.min.css&quot;>
<script src=&quot;https://cdn.jsdelivr.net/npm/basecoat-css@0.3.6/dist/js/all.min.js&quot; defer></script><script type=&quot;module&quot;>import { marked } from &quot;https://cdn.jsdelivr.net/npm/marked/lib/marked.esm.js&quot;;
proc_htmx('.marked', e => e.innerHTML = marked.parse(e.textContent));</script>     <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/styles/atom-one-dark.css&quot; media=&quot;(prefers-color-scheme: dark)&quot;>
     <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/styles/atom-one-light.css&quot; media=&quot;(prefers-color-scheme: light)&quot;>
<script src=&quot;https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/highlight.min.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/gh/arronhunt/highlightjs-copy/dist/highlightjs-copy.min.js&quot;></script>     <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/arronhunt/highlightjs-copy/dist/highlightjs-copy.min.css&quot;>
<script src=&quot;https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/languages/python.min.js&quot;></script><script type=&quot;module&quot;>
hljs.addPlugin(new CopyButtonPlugin());
hljs.configure({'cssSelector': 'pre code:not([data-highlighted=&quot;yes&quot;])'});
htmx.onLoad(hljs.highlightAll);</script><script>
    function sendmsg() {
        window.parent.postMessage({height: document.documentElement.offsetHeight}, '*');
    }
    window.onload = function() {
        sendmsg();
        document.body.addEventListener('htmx:afterSettle',    sendmsg);
        document.body.addEventListener('htmx:wsAfterMessage', sendmsg);
    };</script>   </head>
   <body>
     <h1 class=&quot;text-2xl font-bold&quot; id=&quot;dname&quot; hx-get=&quot;/edit_dname&quot; hx-target=&quot;#dname&quot; hx-swap=&quot;outerHTML&quot;>对话</h1>
   </body>
 </html>
" style="width: 100%; height: auto; border: none;" onload="{
        let frame = this;
        window.addEventListener('message', function(e) {
            if (e.source !== frame.contentWindow) return; // Only proceed if the message is from this iframe
            if (e.data.height) frame.style.height = (e.data.height+1) + 'px';
        }, false);
    }" allow="accelerometer; autoplay; camera; clipboard-read; clipboard-write; display-capture; encrypted-media; fullscreen; gamepad; geolocation; gyroscope; hid; identity-credentials-get; idle-detection; magnetometer; microphone; midi; payment; picture-in-picture; publickey-credentials-get; screen-wake-lock; serial; usb; web-share; xr-spatial-tracking"></iframe> 
</div>
</div>
<p>::: {#5f7ef951 .cell 0=‘e’ 1=‘x’ 2=‘p’ 3=‘o’ 4=‘r’ 5=‘t’ time_run=‘2026-01-22T00:40:10.636548+00:00’}</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb118" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="at">@rt</span></span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> dialog(dnum:<span class="bu">int</span>, session): </span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>    session[<span class="st">'current_dialog'</span>] <span class="op">=</span> dnum</span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> Div(</span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a>        DialogTitle(dialogs[(session[<span class="st">'userid'</span>], dnum)].name),</span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a>        Div(<span class="bu">id</span><span class="op">=</span><span class="st">'msgs'</span>, cls<span class="op">=</span><span class="st">'p-8 max-h-96 overflow-y-auto'</span>, hx_get<span class="op">=</span>load_messages, hx_trigger<span class="op">=</span><span class="st">'load'</span>),</span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a>        TabBar(<span class="bu">id</span><span class="op">=</span><span class="st">'tabbar'</span>),</span>
<span id="cb118-8"><a href="#cb118-8" aria-hidden="true" tabindex="-1"></a>        Div(<span class="bu">id</span><span class="op">=</span><span class="st">'editor'</span>),</span>
<span id="cb118-9"><a href="#cb118-9" aria-hidden="true" tabindex="-1"></a>        cls<span class="op">=</span><span class="st">'tabs w-full'</span></span>
<span id="cb118-10"><a href="#cb118-10" aria-hidden="true" tabindex="-1"></a>    )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>:::</p>
<div id="aec9fe41" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb119" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>prev(<span class="st">'dialog?dnum=1'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p><img src="../images/31_solveit_in_solveit/6.png" class="img-fluid"></p>
</section>
<section id="delete-dialog" class="level3">
<h3 class="anchored" data-anchor-id="delete-dialog">Delete Dialog</h3>
<p>::: {#493dcf03 .cell 0=‘e’ 1=‘x’ 2=‘p’ 3=‘o’ 4=‘r’ 5=‘t’ time_run=‘2026-01-22T00:40:29.905945+00:00’}</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb120" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="at">@rt</span></span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> delete_dialog(session, dnum:<span class="bu">int</span>):</span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a>    uid <span class="op">=</span> session.get(<span class="st">'userid'</span>)</span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a>    dialogs.delete((uid, dnum))</span>
<span id="cb120-5"><a href="#cb120-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">del</span> user_chats[(uid, dnum)]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>:::</p>
<div id="c90ef6df" class="cell" data-time_run="2026-01-22T00:40:30.470264+00:00">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb121" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>fake_session</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="0">
<pre data-code-line-numbers=""><code>{'userid': 1, 'current_dialog': 1}</code></pre>
</div>
</div>
<div id="ed94dd41" class="cell" data-time_run="2026-01-22T00:40:31.202402+00:00">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb123" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>users(), dialogs()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="0">
<pre data-code-line-numbers=""><code>([User(id=1, restore_code='provocative-lori-of-acceptance')],
 [Dialog(id=None, uid=1, dialog_num=1, name='viridian-pegasus', messages='[{"role": "user", "content": "\\u4f60\\u597d", "type": "prompt"}, {"content": "\\u4f60\\u597d\\uff01\\u6709\\u4ec0\\u4e48\\u6211\\u53ef\\u4ee5\\u5e2e\\u60a8\\u7684\\u5417\\uff1f", "role": "assistant", "tool_calls": null, "function_call": null, "provider_specific_fields": {"refusal": null}, "type": "prompt"}, {"role": "user", "content": "\\u54c8\\u55bd", "type": "prompt"}, {"content": "\\u54c8\\u55bd\\uff01\\u5f88\\u9ad8\\u5174\\u53c8\\u89c1\\u5230\\u4f60\\uff5e  \\n\\u4eca\\u5929\\u60f3\\u804a\\u70b9\\u4ec0\\u4e48\\uff0c\\u6216\\u8005\\u6709\\u4ec0\\u4e48\\u9700\\u8981\\u6211\\u5e2e\\u5fd9\\u7684\\uff1f", "role": "assistant", "tool_calls": null, "function_call": null, "provider_specific_fields": {"refusal": null}, "type": "prompt"}, {"role": "user", "content": "[INTERPRETER INPUT]\\n```py\\n1+1\\n```", "type": "code"}, {"role": "assistant", "content": "[INTERPRETER OUTPUT]\\n```py\\n2\\n```", "type": "code"}, {"role": "user", "content": "\\u4e00\\u5f20\\u4fbf\\u8d34", "type": "note"}, {"role": "user", "content": "[INTERPRETER INPUT]\\n```py\\n5**2\\n```", "type": "code"}, {"role": "assistant", "content": "[INTERPRETER OUTPUT]\\n```py\\n25\\n```", "type": "code"}, {"role": "user", "content": "\\u4f60\\u597d", "type": "prompt"}, {"content": "\\u4f60\\u597d\\uff01\\u770b\\u8d77\\u6765\\u4f60\\u521a\\u521a\\u8bd5\\u4e86 1+1 \\u548c 5**2\\uff0c\\u7ed3\\u679c\\u5206\\u522b\\u662f 2 \\u548c 25\\u3002  \\n\\u201c\\u4e00\\u5f20\\u4fbf\\u8d34\\u201d\\u662f\\u60f3\\u8ba9\\u6211\\u5e2e\\u4f60\\u5199\\u70b9\\u4ec0\\u4e48\\u5417\\uff1f\\u8fd8\\u662f\\u6709\\u4ec0\\u4e48\\u522b\\u7684\\u9700\\u6c42\\uff1f", "role": "assistant", "tool_calls": null, "function_call": null, "provider_specific_fields": {"refusal": null}, "type": "prompt"}]', server_session=None)])</code></pre>
</div>
</div>
<div id="8710493b" class="cell" data-time_run="2026-01-22T00:40:33.869075+00:00">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb125" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>user_chats</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="0">
<pre data-code-line-numbers=""><code>{(1, 1): (&lt;lisette.core.Chat at 0x70ee1a6efda0&gt;,
  &lt;IPython.terminal.interactiveshell.TerminalInteractiveShell at 0x70ee225f31a0&gt;)}</code></pre>
</div>
</div>
<div id="3b374041" class="cell" data-time_run="2026-01-22T00:40:34.881908+00:00">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb127" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>delete_dialog(fake_session, <span class="dv">1</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="e177237c" class="cell" data-time_run="2026-01-22T00:40:35.942293+00:00">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb128" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>users(), dialogs()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="0">
<pre data-code-line-numbers=""><code>([User(id=1, restore_code='provocative-lori-of-acceptance')], [])</code></pre>
</div>
</div>
<div id="987e82ba" class="cell" data-time_run="2026-01-22T00:40:37.249208+00:00">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb130" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a>user_chats</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="0">
<pre data-code-line-numbers=""><code>{}</code></pre>
</div>
</div>
</section>
<section id="restore-dialog" class="level3">
<h3 class="anchored" data-anchor-id="restore-dialog">Restore Dialog</h3>
<p>The restore session feature allows users to recover their data if the server restarts or they switch devices. Users enter their unique restore code (generated at account creation), which looks up their account in the database. If found, it restores their session by setting the user ID, loading their first dialog, and redirecting to the main page. A destructive alert displays if the restore code is invalid.</p>
<p>::: {#b7ebe597 .cell 0=‘e’ 1=‘x’ 2=‘p’ 3=‘o’ 4=‘r’ 5=‘t’ time_run=‘2026-01-22T00:40:39.407474+00:00’}</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb132" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a>insolveit <span class="op">=</span> <span class="st">'IN_SOLVEIT'</span> <span class="kw">in</span> os.environ</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>:::</p>
<div id="10d3508c" class="cell" data-time_run="2026-01-22T00:40:40.224216+00:00">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb133" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a>insolveit</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="0">
<pre data-code-line-numbers=""><code>True</code></pre>
</div>
</div>
<p>I’ve created the <code>insolveit</code> check to determine whether the app is running in my SolveIt instance or whether as a deployed app.</p>
<p>::: {#7c59ce58 .cell 0=‘e’ 1=‘x’ 2=‘p’ 3=‘o’ 4=‘r’ 5=‘t’ time_run=‘2026-01-22T00:40:41.808713+00:00’}</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb135" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="at">@rt</span></span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> restore_session(restore_code:<span class="bu">str</span>, session):</span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (u<span class="op">:=</span>first(users(<span class="st">'restore_code=?'</span>, [restore_code]))):</span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a>        session[<span class="st">'userid'</span>] <span class="op">=</span> u.<span class="bu">id</span></span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true" tabindex="-1"></a>        existing <span class="op">=</span> dialogs(where<span class="op">=</span><span class="ss">f'uid=</span><span class="sc">{</span>u<span class="sc">.</span><span class="bu">id</span><span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb135-6"><a href="#cb135-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> existing: session[<span class="st">'current_dialog'</span>] <span class="op">=</span> existing[<span class="dv">0</span>].dialog_num</span>
<span id="cb135-7"><a href="#cb135-7" aria-hidden="true" tabindex="-1"></a>        setsession(session)</span>
<span id="cb135-8"><a href="#cb135-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> HtmxResponseHeaders(redirect<span class="op">=</span><span class="st">'/main'</span> <span class="cf">if</span> insolveit <span class="cf">else</span> <span class="st">'/'</span>)</span>
<span id="cb135-9"><a href="#cb135-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>: <span class="cf">return</span> Div(cls<span class="op">=</span><span class="st">'alert-destructive'</span>)(H2(t(<span class="st">'restore_failed'</span>)), Section(t(<span class="st">'restore_error'</span>)))</span>
<span id="cb135-10"><a href="#cb135-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-11"><a href="#cb135-11" aria-hidden="true" tabindex="-1"></a>    session[<span class="st">'userid'</span>] <span class="op">=</span> first(users(<span class="st">'restore_code=?'</span>, [restore_code])).<span class="bu">id</span></span>
<span id="cb135-12"><a href="#cb135-12" aria-hidden="true" tabindex="-1"></a>    setsession(session)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>:::</p>
<div id="55d6f5c1" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb136" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a>prev(<span class="st">'/restore_session?restore_code=haha'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p><img src="../images/31_solveit_in_solveit/7.png" class="img-fluid"></p>
<div id="339caae0" class="cell" data-time_run="2026-01-22T00:41:13.506574+00:00">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb137" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a>user_chats</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="0">
<pre data-code-line-numbers=""><code>{}</code></pre>
</div>
</div>
<div id="df810c65" class="cell" data-time_run="2026-01-22T00:41:14.234217+00:00">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb139" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a>users[<span class="dv">1</span>].restore_code</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="0">
<pre data-code-line-numbers=""><code>'provocative-lori-of-acceptance'</code></pre>
</div>
</div>
<div id="e39a0de7" class="cell" data-time_run="2026-01-22T00:41:19.073664+00:00">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb141" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a>user_chats <span class="op">=</span> {}</span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a>prev(restore_session.to(restore_code<span class="op">=</span>users[<span class="dv">1</span>].restore_code))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="0">
<iframe src="../../restore_session?restore_code=provocative-lori-of-acceptance" style="width: 100%; height: auto; border: none;" onload="{
        let frame = this;
        window.addEventListener('message', function(e) {
            if (e.source !== frame.contentWindow) return; // Only proceed if the message is from this iframe
            if (e.data.height) frame.style.height = (e.data.height+1) + 'px';
        }, false);
    }" allow="accelerometer; autoplay; camera; clipboard-read; clipboard-write; display-capture; encrypted-media; fullscreen; gamepad; geolocation; gyroscope; hid; identity-credentials-get; idle-detection; magnetometer; microphone; midi; payment; picture-in-picture; publickey-credentials-get; screen-wake-lock; serial; usb; web-share; xr-spatial-tracking"></iframe> 
</div>
</div>
<div id="e4480c35" class="cell" data-time_run="2026-01-22T00:41:54.260492+00:00">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb142" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a>user_chats</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="0">
<pre data-code-line-numbers=""><code>{(1, 1): (&lt;lisette.core.Chat at 0x70ee0bf336e0&gt;,
  &lt;IPython.terminal.interactiveshell.TerminalInteractiveShell at 0x70ee19188fb0&gt;)}</code></pre>
</div>
</div>
<div id="712e7431" class="cell" data-time_run="2026-01-22T00:42:03.520503+00:00">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb144" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a>prev(Div(</span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a>    Form(hx_post<span class="op">=</span>restore_session, hx_target<span class="op">=</span><span class="st">'#alert-area'</span>, cls<span class="op">=</span><span class="st">'flex items-end gap-2'</span>)(</span>
<span id="cb144-3"><a href="#cb144-3" aria-hidden="true" tabindex="-1"></a>        Div()(</span>
<span id="cb144-4"><a href="#cb144-4" aria-hidden="true" tabindex="-1"></a>            Label(<span class="st">'恢复码'</span>, fr<span class="op">=</span><span class="st">'restore_code'</span>, cls<span class="op">=</span><span class="st">'mb-2'</span>),</span>
<span id="cb144-5"><a href="#cb144-5" aria-hidden="true" tabindex="-1"></a>            Input(placeholder<span class="op">=</span><span class="st">'looks-like-this'</span>, <span class="bu">type</span><span class="op">=</span><span class="st">'text'</span>, name<span class="op">=</span><span class="st">'restore_code'</span>)</span>
<span id="cb144-6"><a href="#cb144-6" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb144-7"><a href="#cb144-7" aria-hidden="true" tabindex="-1"></a>        Button(<span class="st">'提交'</span>, <span class="bu">type</span><span class="op">=</span><span class="st">'submit'</span>)</span>
<span id="cb144-8"><a href="#cb144-8" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb144-9"><a href="#cb144-9" aria-hidden="true" tabindex="-1"></a>    Div(<span class="bu">id</span><span class="op">=</span><span class="st">'alert-area'</span>)</span>
<span id="cb144-10"><a href="#cb144-10" aria-hidden="true" tabindex="-1"></a>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="0">
<iframe srcdoc=" <!doctype html>
 <html>
   <head>
     <title>FastHTML page</title>
     <link rel=&quot;canonical&quot; href=&quot;https://testserver/_q7QSnSCySD_yuaCN8jW8Rg&quot;>
     <meta charset=&quot;utf-8&quot;>
     <meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1, viewport-fit=cover&quot;>
<script src=&quot;https://cdn.jsdelivr.net/npm/htmx.org@2.0.7/dist/htmx.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/gh/answerdotai/fasthtml-js@1.0.12/fasthtml.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/gh/answerdotai/surreal@main/surreal.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/gh/gnat/css-scope-inline@main/script.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4&quot;></script>     <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/basecoat-css@0.3.6/dist/basecoat.cdn.min.css&quot;>
<script src=&quot;https://cdn.jsdelivr.net/npm/basecoat-css@0.3.6/dist/js/all.min.js&quot; defer></script><script type=&quot;module&quot;>import { marked } from &quot;https://cdn.jsdelivr.net/npm/marked/lib/marked.esm.js&quot;;
proc_htmx('.marked', e => e.innerHTML = marked.parse(e.textContent));</script>     <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/styles/atom-one-dark.css&quot; media=&quot;(prefers-color-scheme: dark)&quot;>
     <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/styles/atom-one-light.css&quot; media=&quot;(prefers-color-scheme: light)&quot;>
<script src=&quot;https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/highlight.min.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/gh/arronhunt/highlightjs-copy/dist/highlightjs-copy.min.js&quot;></script>     <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/arronhunt/highlightjs-copy/dist/highlightjs-copy.min.css&quot;>
<script src=&quot;https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/languages/python.min.js&quot;></script><script type=&quot;module&quot;>
hljs.addPlugin(new CopyButtonPlugin());
hljs.configure({'cssSelector': 'pre code:not([data-highlighted=&quot;yes&quot;])'});
htmx.onLoad(hljs.highlightAll);</script><script>
    function sendmsg() {
        window.parent.postMessage({height: document.documentElement.offsetHeight}, '*');
    }
    window.onload = function() {
        sendmsg();
        document.body.addEventListener('htmx:afterSettle',    sendmsg);
        document.body.addEventListener('htmx:wsAfterMessage', sendmsg);
    };</script>   </head>
   <body>
     <div>
<form hx-post=&quot;/restore_session&quot; hx-target=&quot;#alert-area&quot; class=&quot;flex items-end gap-2&quot;>         <div>
<label for=&quot;restore_code&quot; class=&quot;label mb-2&quot;>恢复码</label>           <input placeholder=&quot;looks-like-this&quot; type=&quot;text&quot; name=&quot;restore_code&quot; class=&quot;input &quot;>
         </div>
<button type=&quot;submit&quot; class=&quot;btn &quot;>提交</button></form>       <div id=&quot;alert-area&quot;></div>
     </div>
   </body>
 </html>
" style="width: 100%; height: auto; border: none;" onload="{
        let frame = this;
        window.addEventListener('message', function(e) {
            if (e.source !== frame.contentWindow) return; // Only proceed if the message is from this iframe
            if (e.data.height) frame.style.height = (e.data.height+1) + 'px';
        }, false);
    }" allow="accelerometer; autoplay; camera; clipboard-read; clipboard-write; display-capture; encrypted-media; fullscreen; gamepad; geolocation; gyroscope; hid; identity-credentials-get; idle-detection; magnetometer; microphone; midi; payment; picture-in-picture; publickey-credentials-get; screen-wake-lock; serial; usb; web-share; xr-spatial-tracking"></iframe> 
</div>
</div>
<p>::: {#b997e64f .cell 0=‘e’ 1=‘x’ 2=‘p’ 3=‘o’ 4=‘r’ 5=‘t’ time_run=‘2026-01-22T00:42:07.092837+00:00’}</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb145" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> RestoreForm(session, <span class="bu">id</span><span class="op">=</span><span class="st">'restore-form'</span>, <span class="op">*</span>args, <span class="op">**</span>kwargs):</span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> Form(hx_post<span class="op">=</span>restore_session, hx_target<span class="op">=</span><span class="st">'#alert-box'</span>, cls<span class="op">=</span><span class="st">'flex items-end gap-2'</span>, <span class="bu">id</span><span class="op">=</span><span class="bu">id</span>, <span class="op">*</span>args, <span class="op">**</span>kwargs)(</span>
<span id="cb145-3"><a href="#cb145-3" aria-hidden="true" tabindex="-1"></a>        Div(</span>
<span id="cb145-4"><a href="#cb145-4" aria-hidden="true" tabindex="-1"></a>            Label(t(<span class="st">'restore_code'</span>), <span class="st">' · '</span>, users[session[<span class="st">'userid'</span>]].restore_code, fr<span class="op">=</span><span class="st">'restore_code'</span>, cls<span class="op">=</span><span class="st">'mb-2'</span>),</span>
<span id="cb145-5"><a href="#cb145-5" aria-hidden="true" tabindex="-1"></a>            Input(<span class="bu">type</span><span class="op">=</span><span class="st">'text'</span>, name<span class="op">=</span><span class="st">'restore_code'</span>, placeholder<span class="op">=</span>t(<span class="st">'enter_restore_code'</span>))</span>
<span id="cb145-6"><a href="#cb145-6" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb145-7"><a href="#cb145-7" aria-hidden="true" tabindex="-1"></a>        Button(t(<span class="st">'submit'</span>), <span class="bu">type</span><span class="op">=</span><span class="st">'submit'</span>)</span>
<span id="cb145-8"><a href="#cb145-8" aria-hidden="true" tabindex="-1"></a>    )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>:::</p>
<div id="d3f6971a" class="cell" data-time_run="2026-01-22T00:42:10.211228+00:00">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb146" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a>prev(RestoreForm(fake_session))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="0">
<iframe srcdoc=" <!doctype html>
 <html>
   <head>
     <title>FastHTML page</title>
     <link rel=&quot;canonical&quot; href=&quot;https://testserver/_z-mQL0X7R1qfFXWTNVyukA&quot;>
     <meta charset=&quot;utf-8&quot;>
     <meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1, viewport-fit=cover&quot;>
<script src=&quot;https://cdn.jsdelivr.net/npm/htmx.org@2.0.7/dist/htmx.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/gh/answerdotai/fasthtml-js@1.0.12/fasthtml.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/gh/answerdotai/surreal@main/surreal.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/gh/gnat/css-scope-inline@main/script.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4&quot;></script>     <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/basecoat-css@0.3.6/dist/basecoat.cdn.min.css&quot;>
<script src=&quot;https://cdn.jsdelivr.net/npm/basecoat-css@0.3.6/dist/js/all.min.js&quot; defer></script><script type=&quot;module&quot;>import { marked } from &quot;https://cdn.jsdelivr.net/npm/marked/lib/marked.esm.js&quot;;
proc_htmx('.marked', e => e.innerHTML = marked.parse(e.textContent));</script>     <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/styles/atom-one-dark.css&quot; media=&quot;(prefers-color-scheme: dark)&quot;>
     <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/styles/atom-one-light.css&quot; media=&quot;(prefers-color-scheme: light)&quot;>
<script src=&quot;https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/highlight.min.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/gh/arronhunt/highlightjs-copy/dist/highlightjs-copy.min.js&quot;></script>     <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/arronhunt/highlightjs-copy/dist/highlightjs-copy.min.css&quot;>
<script src=&quot;https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/languages/python.min.js&quot;></script><script type=&quot;module&quot;>
hljs.addPlugin(new CopyButtonPlugin());
hljs.configure({'cssSelector': 'pre code:not([data-highlighted=&quot;yes&quot;])'});
htmx.onLoad(hljs.highlightAll);</script><script>
    function sendmsg() {
        window.parent.postMessage({height: document.documentElement.offsetHeight}, '*');
    }
    window.onload = function() {
        sendmsg();
        document.body.addEventListener('htmx:afterSettle',    sendmsg);
        document.body.addEventListener('htmx:wsAfterMessage', sendmsg);
    };</script>   </head>
   <body>
<form hx-post=&quot;/restore_session&quot; hx-target=&quot;#alert-box&quot; class=&quot;flex items-end gap-2&quot; id=&quot;restore-form&quot;>       <div>
<label for=&quot;restore_code&quot; class=&quot;label mb-2&quot;>Restore Code · provocative-lori-of-acceptance</label>         <input type=&quot;text&quot; name=&quot;restore_code&quot; placeholder=&quot;Enter restore code...&quot; class=&quot;input &quot;>
       </div>
<button type=&quot;submit&quot; class=&quot;btn &quot;>Submit</button></form>   </body>
 </html>
" style="width: 100%; height: auto; border: none;" onload="{
        let frame = this;
        window.addEventListener('message', function(e) {
            if (e.source !== frame.contentWindow) return; // Only proceed if the message is from this iframe
            if (e.data.height) frame.style.height = (e.data.height+1) + 'px';
        }, false);
    }" allow="accelerometer; autoplay; camera; clipboard-read; clipboard-write; display-capture; encrypted-media; fullscreen; gamepad; geolocation; gyroscope; hid; identity-credentials-get; idle-detection; magnetometer; microphone; midi; payment; picture-in-picture; publickey-credentials-get; screen-wake-lock; serial; usb; web-share; xr-spatial-tracking"></iframe> 
</div>
</div>
</section>
<section id="dialog-list" class="level3">
<h3 class="anchored" data-anchor-id="dialog-list">Dialog List</h3>
<p>The dialog list component displays all dialogs belonging to the current user. The <code>display_dialogs</code> route fetches all user dialogs from the database and includes a “new dialog” card that triggers dialog creation. The restore code form is also embedded here, allowing users to recover their session from a different device.</p>
<p>::: {#7fde0067 .cell 0=‘e’ 1=‘x’ 2=‘p’ 3=‘o’ 4=‘r’ 5=‘t’ time_run=‘2026-01-22T00:42:13.946257+00:00’}</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb147" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="at">@rt</span></span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> current_dialog(session): <span class="cf">return</span> dialog(session.get(<span class="st">'current_dialog'</span>), session)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>:::</p>
<p>::: {#d1206a9d .cell 0=‘e’ 1=‘x’ 2=‘p’ 3=‘o’ 4=‘r’ 5=‘t’ time_run=‘2026-01-22T00:42:14.672987+00:00’}</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb148" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> DialogCard(d): <span class="cf">return</span> Div(<span class="bu">id</span><span class="op">=</span><span class="ss">f'dialog-</span><span class="sc">{</span>d<span class="sc">.</span>uid<span class="sc">}{</span>d<span class="sc">.</span>dialog_num<span class="sc">}</span><span class="ss">'</span>, cls<span class="op">=</span><span class="st">'card p-4 hover:bg-gray-100 flex flex-row justify-between items-center'</span>)(</span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a>    Span(hx_get<span class="op">=</span>dialog.to(dnum<span class="op">=</span>d.dialog_num), hx_target<span class="op">=</span><span class="st">'#content'</span>, cls<span class="op">=</span><span class="st">'cursor-pointer'</span>)(<span class="st">'💬 '</span>, d.name), </span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a>    Button(t(<span class="st">'delete'</span>), var<span class="op">=</span><span class="st">'destructive'</span>, hx_post<span class="op">=</span>delete_dialog.to(dnum<span class="op">=</span>d.dialog_num), hx_swap<span class="op">=</span><span class="st">'delete'</span>, hx_target<span class="op">=</span><span class="ss">f'#dialog-</span><span class="sc">{</span>d<span class="sc">.</span>uid<span class="sc">}{</span>d<span class="sc">.</span>dialog_num<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb148-4"><a href="#cb148-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>:::</p>
<div id="abb01407" class="cell" data-time_run="2026-01-22T00:42:17.474620+00:00">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb149" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a>prev(DialogCard(first(dialogs())))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="0">
<iframe srcdoc=" <!doctype html>
 <html>
   <head>
     <title>FastHTML page</title>
     <link rel=&quot;canonical&quot; href=&quot;https://testserver/_6Y1bRgKQTmC8z9EN5_DnGA&quot;>
     <meta charset=&quot;utf-8&quot;>
     <meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1, viewport-fit=cover&quot;>
<script src=&quot;https://cdn.jsdelivr.net/npm/htmx.org@2.0.7/dist/htmx.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/gh/answerdotai/fasthtml-js@1.0.12/fasthtml.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/gh/answerdotai/surreal@main/surreal.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/gh/gnat/css-scope-inline@main/script.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4&quot;></script>     <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/basecoat-css@0.3.6/dist/basecoat.cdn.min.css&quot;>
<script src=&quot;https://cdn.jsdelivr.net/npm/basecoat-css@0.3.6/dist/js/all.min.js&quot; defer></script><script type=&quot;module&quot;>import { marked } from &quot;https://cdn.jsdelivr.net/npm/marked/lib/marked.esm.js&quot;;
proc_htmx('.marked', e => e.innerHTML = marked.parse(e.textContent));</script>     <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/styles/atom-one-dark.css&quot; media=&quot;(prefers-color-scheme: dark)&quot;>
     <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/styles/atom-one-light.css&quot; media=&quot;(prefers-color-scheme: light)&quot;>
<script src=&quot;https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/highlight.min.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/gh/arronhunt/highlightjs-copy/dist/highlightjs-copy.min.js&quot;></script>     <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/arronhunt/highlightjs-copy/dist/highlightjs-copy.min.css&quot;>
<script src=&quot;https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/languages/python.min.js&quot;></script><script type=&quot;module&quot;>
hljs.addPlugin(new CopyButtonPlugin());
hljs.configure({'cssSelector': 'pre code:not([data-highlighted=&quot;yes&quot;])'});
htmx.onLoad(hljs.highlightAll);</script><script>
    function sendmsg() {
        window.parent.postMessage({height: document.documentElement.offsetHeight}, '*');
    }
    window.onload = function() {
        sendmsg();
        document.body.addEventListener('htmx:afterSettle',    sendmsg);
        document.body.addEventListener('htmx:wsAfterMessage', sendmsg);
    };</script>   </head>
   <body>
     <div id=&quot;dialog-11&quot; class=&quot;card p-4 hover:bg-gray-100 flex flex-row justify-between items-center&quot;>
<span hx-get=&quot;/dialog?dnum=1&quot; hx-target=&quot;#content&quot; class=&quot;cursor-pointer&quot;>💬 gleaming-tortoise</span><button hx-post=&quot;/delete_dialog?dnum=1&quot; hx-swap=&quot;delete&quot; hx-target=&quot;#dialog-11&quot; class=&quot;btn-destructive &quot;>Delete</button>     </div>
   </body>
 </html>
" style="width: 100%; height: auto; border: none;" onload="{
        let frame = this;
        window.addEventListener('message', function(e) {
            if (e.source !== frame.contentWindow) return; // Only proceed if the message is from this iframe
            if (e.data.height) frame.style.height = (e.data.height+1) + 'px';
        }, false);
    }" allow="accelerometer; autoplay; camera; clipboard-read; clipboard-write; display-capture; encrypted-media; fullscreen; gamepad; geolocation; gyroscope; hid; identity-credentials-get; idle-detection; magnetometer; microphone; midi; payment; picture-in-picture; publickey-credentials-get; screen-wake-lock; serial; usb; web-share; xr-spatial-tracking"></iframe> 
</div>
</div>
<p>::: {#4151e92e .cell 0=‘e’ 1=‘x’ 2=‘p’ 3=‘o’ 4=‘r’ 5=‘t’ time_run=‘2026-01-22T00:42:23.354678+00:00’}</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb150" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="at">@rt</span></span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> display_dialogs(session):</span>
<span id="cb150-3"><a href="#cb150-3" aria-hidden="true" tabindex="-1"></a>    ds <span class="op">=</span> L(dialogs(<span class="st">'uid=?'</span>, [session.get(<span class="st">'userid'</span>)]))</span>
<span id="cb150-4"><a href="#cb150-4" aria-hidden="true" tabindex="-1"></a>    ds <span class="op">=</span> ds.<span class="bu">map</span>(<span class="kw">lambda</span> d: DialogCard(d))</span>
<span id="cb150-5"><a href="#cb150-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> Div(cls<span class="op">=</span><span class="st">'flex flex-col gap-2 max-w-xl'</span>)(</span>
<span id="cb150-6"><a href="#cb150-6" aria-hidden="true" tabindex="-1"></a>        Div(cls<span class="op">=</span><span class="st">'flex items-center justify-between gap-4'</span>)(H1(t(<span class="st">'all_dialogs'</span>, session), cls<span class="op">=</span><span class="st">'text-2xl font-bold'</span>, <span class="bu">id</span><span class="op">=</span><span class="st">'all-dialogs-title'</span>), RestoreForm(session)), </span>
<span id="cb150-7"><a href="#cb150-7" aria-hidden="true" tabindex="-1"></a>        Div(<span class="bu">id</span><span class="op">=</span><span class="st">'alert-box'</span>),</span>
<span id="cb150-8"><a href="#cb150-8" aria-hidden="true" tabindex="-1"></a>        Div(<span class="st">'➕'</span>, Span(t(<span class="st">'new_dialog'</span>, session), <span class="bu">id</span><span class="op">=</span><span class="st">'new-dialog-text'</span>), cls<span class="op">=</span><span class="st">'card p-4 hover:bg-gray-100 cursor-pointer border-2 border-dashed flex flex-row items-center gap-2'</span>, hx_post<span class="op">=</span>create_dialog, hx_target<span class="op">=</span><span class="st">'#content'</span>),</span>
<span id="cb150-9"><a href="#cb150-9" aria-hidden="true" tabindex="-1"></a>        Div(<span class="op">*</span>ds, cls<span class="op">=</span><span class="st">'flex flex-col gap-2 max-h-64 overflow-y-auto'</span>)</span>
<span id="cb150-10"><a href="#cb150-10" aria-hidden="true" tabindex="-1"></a>    )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>:::</p>
<div id="a5483063" class="cell" data-time_run="2026-01-22T00:42:27.709041+00:00">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb151" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a>prev(Div(</span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a>    Div(<span class="bu">id</span><span class="op">=</span><span class="st">'content'</span>)(</span>
<span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a>        display_dialogs({<span class="st">'userid'</span>: <span class="dv">1</span>, <span class="st">'current_dialog'</span>: <span class="dv">11</span>})</span>
<span id="cb151-4"><a href="#cb151-4" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb151-5"><a href="#cb151-5" aria-hidden="true" tabindex="-1"></a>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="0">
<iframe srcdoc=" <!doctype html>
 <html>
   <head>
     <title>FastHTML page</title>
     <link rel=&quot;canonical&quot; href=&quot;https://testserver/_WYKxlDFyRQWPOl1fhn8wFA&quot;>
     <meta charset=&quot;utf-8&quot;>
     <meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1, viewport-fit=cover&quot;>
<script src=&quot;https://cdn.jsdelivr.net/npm/htmx.org@2.0.7/dist/htmx.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/gh/answerdotai/fasthtml-js@1.0.12/fasthtml.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/gh/answerdotai/surreal@main/surreal.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/gh/gnat/css-scope-inline@main/script.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4&quot;></script>     <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/basecoat-css@0.3.6/dist/basecoat.cdn.min.css&quot;>
<script src=&quot;https://cdn.jsdelivr.net/npm/basecoat-css@0.3.6/dist/js/all.min.js&quot; defer></script><script type=&quot;module&quot;>import { marked } from &quot;https://cdn.jsdelivr.net/npm/marked/lib/marked.esm.js&quot;;
proc_htmx('.marked', e => e.innerHTML = marked.parse(e.textContent));</script>     <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/styles/atom-one-dark.css&quot; media=&quot;(prefers-color-scheme: dark)&quot;>
     <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/styles/atom-one-light.css&quot; media=&quot;(prefers-color-scheme: light)&quot;>
<script src=&quot;https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/highlight.min.js&quot;></script><script src=&quot;https://cdn.jsdelivr.net/gh/arronhunt/highlightjs-copy/dist/highlightjs-copy.min.js&quot;></script>     <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/arronhunt/highlightjs-copy/dist/highlightjs-copy.min.css&quot;>
<script src=&quot;https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/languages/python.min.js&quot;></script><script type=&quot;module&quot;>
hljs.addPlugin(new CopyButtonPlugin());
hljs.configure({'cssSelector': 'pre code:not([data-highlighted=&quot;yes&quot;])'});
htmx.onLoad(hljs.highlightAll);</script><script>
    function sendmsg() {
        window.parent.postMessage({height: document.documentElement.offsetHeight}, '*');
    }
    window.onload = function() {
        sendmsg();
        document.body.addEventListener('htmx:afterSettle',    sendmsg);
        document.body.addEventListener('htmx:wsAfterMessage', sendmsg);
    };</script>   </head>
   <body>
     <div>
       <div id=&quot;content&quot;>
         <div class=&quot;flex flex-col gap-2 max-w-xl&quot;>
           <div class=&quot;flex items-center justify-between gap-4&quot;>
             <h1 class=&quot;text-2xl font-bold&quot; id=&quot;all-dialogs-title&quot;>所有对话</h1>
<form hx-post=&quot;/restore_session&quot; hx-target=&quot;#alert-box&quot; class=&quot;flex items-end gap-2&quot; id=&quot;restore-form&quot;>               <div>
<label for=&quot;restore_code&quot; class=&quot;label mb-2&quot;>Restore Code · provocative-lori-of-acceptance</label>                 <input type=&quot;text&quot; name=&quot;restore_code&quot; placeholder=&quot;Enter restore code...&quot; class=&quot;input &quot;>
               </div>
<button type=&quot;submit&quot; class=&quot;btn &quot;>Submit</button></form>           </div>
           <div id=&quot;alert-box&quot;></div>
           <div class=&quot;card p-4 hover:bg-gray-100 cursor-pointer border-2 border-dashed flex flex-row items-center gap-2&quot; hx-post=&quot;/create_dialog&quot; hx-target=&quot;#content&quot;>
➕<span id=&quot;new-dialog-text&quot;>新对话</span>           </div>
           <div class=&quot;flex flex-col gap-2 max-h-64 overflow-y-auto&quot;>
             <div id=&quot;dialog-11&quot; class=&quot;card p-4 hover:bg-gray-100 flex flex-row justify-between items-center&quot;>
<span hx-get=&quot;/dialog?dnum=1&quot; hx-target=&quot;#content&quot; class=&quot;cursor-pointer&quot;>💬 gleaming-tortoise</span><button hx-post=&quot;/delete_dialog?dnum=1&quot; hx-swap=&quot;delete&quot; hx-target=&quot;#dialog-11&quot; class=&quot;btn-destructive &quot;>Delete</button>             </div>
           </div>
         </div>
       </div>
     </div>
   </body>
 </html>
" style="width: 100%; height: auto; border: none;" onload="{
        let frame = this;
        window.addEventListener('message', function(e) {
            if (e.source !== frame.contentWindow) return; // Only proceed if the message is from this iframe
            if (e.data.height) frame.style.height = (e.data.height+1) + 'px';
        }, false);
    }" allow="accelerometer; autoplay; camera; clipboard-read; clipboard-write; display-capture; encrypted-media; fullscreen; gamepad; geolocation; gyroscope; hid; identity-credentials-get; idle-detection; magnetometer; microphone; midi; payment; picture-in-picture; publickey-credentials-get; screen-wake-lock; serial; usb; web-share; xr-spatial-tracking"></iframe> 
</div>
</div>
</section>
<section id="main-page" class="level3">
<h3 class="anchored" data-anchor-id="main-page">Main Page</h3>
<p>::: {#886bc7d5 .cell 0=‘e’ 1=‘x’ 2=‘p’ 3=‘o’ 4=‘r’ 5=‘t’ time_run=‘2026-01-22T00:42:30.692188+00:00’}</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb152" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="at">@rt</span></span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> toggle_lang(session):</span>
<span id="cb152-3"><a href="#cb152-3" aria-hidden="true" tabindex="-1"></a>    lang <span class="op">=</span> <span class="st">'zh'</span> <span class="cf">if</span> session.get(<span class="st">'lang'</span>) <span class="op">==</span> <span class="st">'en'</span> <span class="cf">else</span> <span class="st">'en'</span></span>
<span id="cb152-4"><a href="#cb152-4" aria-hidden="true" tabindex="-1"></a>    current_lang.<span class="bu">set</span>(lang)</span>
<span id="cb152-5"><a href="#cb152-5" aria-hidden="true" tabindex="-1"></a>    session[<span class="st">'lang'</span>] <span class="op">=</span> lang</span>
<span id="cb152-6"><a href="#cb152-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (</span>
<span id="cb152-7"><a href="#cb152-7" aria-hidden="true" tabindex="-1"></a>        H2(t(<span class="st">'solveit_lite'</span>), <span class="bu">id</span><span class="op">=</span><span class="st">'title'</span>, hx_swap_oob<span class="op">=</span><span class="st">'true'</span>),</span>
<span id="cb152-8"><a href="#cb152-8" aria-hidden="true" tabindex="-1"></a>        Button(t(<span class="st">'all_dialogs'</span>), <span class="bu">id</span><span class="op">=</span><span class="st">'dialogs-btn'</span>, hx_post<span class="op">=</span>display_dialogs, hx_target<span class="op">=</span><span class="st">'#content'</span>, var<span class="op">=</span><span class="st">'secondary'</span>, hx_swap_oob<span class="op">=</span><span class="st">'true'</span>),</span>
<span id="cb152-9"><a href="#cb152-9" aria-hidden="true" tabindex="-1"></a>        Span(t(<span class="st">'code'</span>), hx_swap_oob<span class="op">=</span><span class="st">'innerHTML:#code-tab'</span>),</span>
<span id="cb152-10"><a href="#cb152-10" aria-hidden="true" tabindex="-1"></a>        Span(t(<span class="st">'prompt'</span>), hx_swap_oob<span class="op">=</span><span class="st">'innerHTML:#qry-tab'</span>),</span>
<span id="cb152-11"><a href="#cb152-11" aria-hidden="true" tabindex="-1"></a>        Span(t(<span class="st">'note'</span>), hx_swap_oob<span class="op">=</span><span class="st">'innerHTML:#note-tab'</span>),</span>
<span id="cb152-12"><a href="#cb152-12" aria-hidden="true" tabindex="-1"></a>        Div(<span class="bu">id</span><span class="op">=</span><span class="st">'editor'</span>, hx_swap_oob<span class="op">=</span><span class="st">'true'</span>),</span>
<span id="cb152-13"><a href="#cb152-13" aria-hidden="true" tabindex="-1"></a>        Footer(t(<span class="st">'footer'</span>), <span class="bu">id</span><span class="op">=</span><span class="st">'footer'</span>, cls<span class="op">=</span><span class="st">'text-sm text-gray-400'</span>, hx_swap_oob<span class="op">=</span><span class="st">'true'</span>),</span>
<span id="cb152-14"><a href="#cb152-14" aria-hidden="true" tabindex="-1"></a>        RestoreForm(session, hx_swap_oob<span class="op">=</span><span class="st">'true'</span>, <span class="bu">id</span><span class="op">=</span><span class="st">'restore-form'</span>),</span>
<span id="cb152-15"><a href="#cb152-15" aria-hidden="true" tabindex="-1"></a>        H1(t(<span class="st">'all_dialogs'</span>), cls<span class="op">=</span><span class="st">'text-2xl font-bold'</span>, <span class="bu">id</span><span class="op">=</span><span class="st">'all-dialogs-title'</span>, hx_swap_oob<span class="op">=</span><span class="st">'true'</span>),</span>
<span id="cb152-16"><a href="#cb152-16" aria-hidden="true" tabindex="-1"></a>        Span(t(<span class="st">'new_dialog'</span>), <span class="bu">id</span><span class="op">=</span><span class="st">'new-dialog-text'</span>, hx_swap_oob<span class="op">=</span><span class="st">'true'</span>)</span>
<span id="cb152-17"><a href="#cb152-17" aria-hidden="true" tabindex="-1"></a>    )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>:::</p>
<p>This route allows users to switch between Chinese and English with OOB swaps to update all translatable text across the page simultaneously.</p>
<p>::: {#e98d1f46 .cell 0=‘e’ 1=‘x’ 2=‘p’ 3=‘o’ 4=‘r’ 5=‘t’ time_run=‘2026-01-22T00:42:32.887451+00:00’}</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb153" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="at">@rt</span>(<span class="st">'/main'</span> <span class="cf">if</span> insolveit <span class="cf">else</span> <span class="st">'/'</span>)</span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> main(session):</span>
<span id="cb153-3"><a href="#cb153-3" aria-hidden="true" tabindex="-1"></a>    setsession(session)</span>
<span id="cb153-4"><a href="#cb153-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> Div(<span class="bu">id</span><span class="op">=</span><span class="st">'body'</span>, cls<span class="op">=</span><span class="st">'card p-8 max-w-4xl mx-auto my-4'</span>)(</span>
<span id="cb153-5"><a href="#cb153-5" aria-hidden="true" tabindex="-1"></a>        Header(cls<span class="op">=</span><span class="st">'flex justify-between items-center'</span>)(H2(</span>
<span id="cb153-6"><a href="#cb153-6" aria-hidden="true" tabindex="-1"></a>            t(<span class="st">'solveit_lite'</span>), <span class="bu">id</span><span class="op">=</span><span class="st">'title'</span>), </span>
<span id="cb153-7"><a href="#cb153-7" aria-hidden="true" tabindex="-1"></a>            Span(</span>
<span id="cb153-8"><a href="#cb153-8" aria-hidden="true" tabindex="-1"></a>                Button(<span class="st">'🌐'</span>, var<span class="op">=</span><span class="st">'secondary'</span>, hx_post<span class="op">=</span>toggle_lang, hx_swap<span class="op">=</span><span class="st">'none'</span>), </span>
<span id="cb153-9"><a href="#cb153-9" aria-hidden="true" tabindex="-1"></a>                Button(t(<span class="st">'all_dialogs'</span>), <span class="bu">id</span><span class="op">=</span><span class="st">'dialogs-btn'</span>, hx_post<span class="op">=</span>display_dialogs, hx_target<span class="op">=</span><span class="st">'#content'</span>, var<span class="op">=</span><span class="st">'secondary'</span>)</span>
<span id="cb153-10"><a href="#cb153-10" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb153-11"><a href="#cb153-11" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb153-12"><a href="#cb153-12" aria-hidden="true" tabindex="-1"></a>        Section(<span class="bu">id</span><span class="op">=</span><span class="st">'content'</span>)(</span>
<span id="cb153-13"><a href="#cb153-13" aria-hidden="true" tabindex="-1"></a>            current_dialog(session)</span>
<span id="cb153-14"><a href="#cb153-14" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb153-15"><a href="#cb153-15" aria-hidden="true" tabindex="-1"></a>        Footer(t(<span class="st">'footer'</span>), <span class="bu">id</span><span class="op">=</span><span class="st">'footer'</span>, cls<span class="op">=</span><span class="st">'text-sm text-gray-400'</span>)</span>
<span id="cb153-16"><a href="#cb153-16" aria-hidden="true" tabindex="-1"></a>    )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>:::</p>
<div id="fe1e1311" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb154" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a>prev(<span class="st">'/main'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p><img src="../images/31_solveit_in_solveit/8.png" class="img-fluid"></p>
</section>
<section id="deploy" class="level3">
<h3 class="anchored" data-anchor-id="deploy">Deploy</h3>
<p>::: {#b05651d9 .cell 0=‘e’ 1=‘x’ 2=‘p’ 3=‘o’ 4=‘r’ 5=‘t’}</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb155" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> insolveit: serve()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>:::</p>
<div id="ce0a150b" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb156" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a>Path(<span class="st">'requirements.txt'</span>).write_text(<span class="st">'''</span><span class="op">\</span></span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a><span class="st">python-fasthtml</span></span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a><span class="st">lisette</span></span>
<span id="cb156-4"><a href="#cb156-4" aria-hidden="true" tabindex="-1"></a><span class="st">coolname</span></span>
<span id="cb156-5"><a href="#cb156-5" aria-hidden="true" tabindex="-1"></a><span class="st">ipython</span></span>
<span id="cb156-6"><a href="#cb156-6" aria-hidden="true" tabindex="-1"></a><span class="st">'''</span>)</span>
<span id="cb156-7"><a href="#cb156-7" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>cat requirements.txt</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code>python-fasthtml
lisette
coolname
ipython</code></pre>
</div>
</div>
<div id="81c5cb9a" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb158" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a>Path(<span class="st">'.plash'</span>).write_text(<span class="st">'export PLASH_APP_NAME=solveit-lite-unofficial'</span>)</span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>cat .plash</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code>export PLASH_APP_NAME=solveit-lite-unofficial</code></pre>
</div>
</div>
<div id="074192d9" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb160" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a>Path(<span class="st">'plash.env'</span>).write_text(<span class="ss">f'export MOONSHOT_API_KEY=</span><span class="sc">{</span>os<span class="sc">.</span>environ<span class="sc">.</span>get(<span class="st">'MOONSHOT_API_KEY'</span>)<span class="sc">}</span><span class="ss">'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="0">
<pre data-code-line-numbers=""><code>75</code></pre>
</div>
</div>
<div id="8fc1ace6" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb162" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plash_cli <span class="im">as</span> pc</span>
<span id="cb162-2"><a href="#cb162-2" aria-hidden="true" tabindex="-1"></a>pc.deploy()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="0">
<pre data-code-line-numbers=""><code>'https://solveit-lite-unofficial.pla.sh'</code></pre>
</div>
</div>
<div id="e366368c" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb164" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(pc.logs())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code>Build Start Time: 2026-01-16 01:30:30.917195+00:00
Step 1/14 : FROM plash:latest
 ---&gt; 8c65e51fa2d2
Step 2/14 : ARG USER_UID=1000
 ---&gt; Using cache
 ---&gt; 781580c8e262
Step 3/14 : ARG USER_GID=1000
 ---&gt; Using cache
 ---&gt; dcf3956b8c50
Step 4/14 : RUN groupadd -g $USER_GID plash &amp;&amp; useradd -u $USER_UID -g $USER_GID -m plash
 ---&gt; Using cache
 ---&gt; fe019dc49177
Step 5/14 : ENV PLASH_PRODUCTION=1
 ---&gt; Using cache
 ---&gt; a86e28497fc0
Step 6/14 : COPY .dockerignore setup.sh* ./
 ---&gt; Using cache
 ---&gt; 786f3c3d2c09
Step 7/14 : RUN if [ -f ./setup.sh ]; then echo "Found setup.sh, executing..." &amp;&amp; chmod +x ./setup.sh &amp;&amp; ./setup.sh; fi
 ---&gt; Using cache
 ---&gt; 3f80b2a299d3
Step 8/14 : COPY .dockerignore requirements.txt* ./
 ---&gt; Using cache
 ---&gt; dea62d9dd70b
Step 9/14 : RUN if [ -f ./requirements.txt ]; then echo "Found requirements.txt, executing..." &amp;&amp; uv pip install -r ./requirements.txt --system; fi
 ---&gt; Using cache
 ---&gt; 241057bc8973
Step 10/14 : RUN chown -R plash:plash /app
 ---&gt; Using cache
 ---&gt; eb5b444c975f
Step 11/14 : USER plash
 ---&gt; Using cache
 ---&gt; d2eda950b2e1
Step 12/14 : ENV PATH="/home/plash/.local/bin:$PATH"
 ---&gt; Using cache
 ---&gt; 5631843ecbf7
Step 13/14 : EXPOSE 5001
 ---&gt; Using cache
 ---&gt; b1e69db470b1
Step 14/14 : ENTRYPOINT ["bash", "-c", "if [ -f ./plash.env ]; then . ./plash.env; fi &amp;&amp; python main.py"]
 ---&gt; Using cache
 ---&gt; 5ad4e58136f3
Successfully built 5ad4e58136f3
Successfully tagged 9d102cbb-e493-4ce7-9110-09dbf5c01851:latest

Build End Time: 2026-01-16 01:30:31.194696+00:00
</code></pre>
</div>
</div>
<div id="919d93ef" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb166" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(pc.logs(mode<span class="op">=</span><span class="st">'app'</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code>INFO:     Will watch for changes in these directories: ['/app']
INFO:     Uvicorn running on http://0.0.0.0:5001 (Press CTRL+C to quit)
INFO:     Started reloader process [1] using WatchFiles
Link: http://localhost:5001
INFO:     Started server process [14]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
</code></pre>
</div>
</div>
<div id="40589a55" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb168" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> httpx</span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(httpx.get(<span class="st">'https://solveit-lite-unofficial.pla.sh'</span>).text)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code> &lt;!doctype html&gt;
 &lt;html&gt;
   &lt;head&gt;
     &lt;title&gt;FastHTML page&lt;/title&gt;
     &lt;link rel="canonical" href="https://solveit-lite-unofficial.pla.sh/"&gt;
     &lt;meta charset="utf-8"&gt;
     &lt;meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"&gt;
&lt;script src="https://cdn.jsdelivr.net/npm/htmx.org@2.0.7/dist/htmx.js"&gt;&lt;/script&gt;&lt;script src="https://cdn.jsdelivr.net/gh/answerdotai/fasthtml-js@1.0.12/fasthtml.js"&gt;&lt;/script&gt;&lt;script src="https://cdn.jsdelivr.net/gh/answerdotai/surreal@main/surreal.js"&gt;&lt;/script&gt;&lt;script src="https://cdn.jsdelivr.net/gh/gnat/css-scope-inline@main/script.js"&gt;&lt;/script&gt;&lt;script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"&gt;&lt;/script&gt;     &lt;link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/basecoat-css@0.3.6/dist/basecoat.cdn.min.css"&gt;
&lt;script src="https://cdn.jsdelivr.net/npm/basecoat-css@0.3.6/dist/js/all.min.js" defer&gt;&lt;/script&gt;&lt;script type="module"&gt;import { marked } from "https://cdn.jsdelivr.net/npm/marked/lib/marked.esm.js";
proc_htmx('.marked', e =&gt; e.innerHTML = marked.parse(e.textContent));&lt;/script&gt;     &lt;link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/styles/atom-one-dark.css" media="(prefers-color-scheme: dark)"&gt;
     &lt;link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/styles/atom-one-light.css" media="(prefers-color-scheme: light)"&gt;
&lt;script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/highlight.min.js"&gt;&lt;/script&gt;&lt;script src="https://cdn.jsdelivr.net/gh/arronhunt/highlightjs-copy/dist/highlightjs-copy.min.js"&gt;&lt;/script&gt;     &lt;link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/arronhunt/highlightjs-copy/dist/highlightjs-copy.min.css"&gt;
&lt;script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/languages/python.min.js"&gt;&lt;/script&gt;&lt;script type="module"&gt;
hljs.addPlugin(new CopyButtonPlugin());
hljs.configure({'cssSelector': 'pre code:not([data-highlighted="yes"])'});
htmx.onLoad(hljs.highlightAll);&lt;/script&gt;   &lt;/head&gt;
   &lt;body&gt;
     &lt;div id="body" class="card p-8 max-w-4xl mx-auto my-4"&gt;
       &lt;header class="flex justify-between items-center"&gt;
         &lt;h2 id="title"&gt;solveit-lite&lt;/h2&gt;
&lt;span&gt;&lt;button hx-post="/toggle_lang" hx-swap="none" class="btn-secondary "&gt;🌐&lt;/button&gt;&lt;button hx-post="/display_dialogs" hx-target="#content" id="dialogs-btn" class="btn-secondary " name="dialogs-btn"&gt;All Dialogs&lt;/button&gt;&lt;/span&gt;       &lt;/header&gt;
       &lt;section id="content"&gt;
         &lt;div class="tabs w-full"&gt;
           &lt;h1 class="text-2xl font-bold" id="dname" hx-get="/edit_dname" hx-target="#dname" hx-swap="outerHTML"&gt;intrepid-turaco&lt;/h1&gt;
           &lt;div id="msgs" class="p-8 max-h-96 overflow-y-auto" hx-get="/load_messages" hx-trigger="load"&gt;&lt;/div&gt;
           &lt;nav class="w-full " role="tablist" id="tabbar"&gt;
&lt;button type="button" role="tab" hx-post="/code_editor" hx-swap="innerHTML" hx-target="#editor" id="code-tab" name="code-tab"&gt;Code&lt;/button&gt;&lt;button type="button" role="tab" hx-post="/llm_editor" hx-swap="innerHTML" hx-target="#editor" id="qry-tab" name="qry-tab"&gt;Prompt&lt;/button&gt;&lt;button type="button" role="tab" hx-post="/note_editor" hx-swap="innerHTML" hx-target="#editor" id="note-tab" name="note-tab"&gt;Note&lt;/button&gt;           &lt;/nav&gt;
           &lt;div id="editor"&gt;&lt;/div&gt;
         &lt;/div&gt;
       &lt;/section&gt;
       &lt;footer id="footer" class="text-sm text-gray-400"&gt;Crafted with FastHTML&lt;/footer&gt;
     &lt;/div&gt;
   &lt;/body&gt;
 &lt;/html&gt;
</code></pre>
</div>
</div>
<hr>
<p>If you have any comments, questions, suggestions, feedback, criticisms, or corrections, please do post them down in the comment section below!</p>


</section>

<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/forbo7\.github\.io\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<input type="hidden" id="giscus-base-theme" value="light">
<input type="hidden" id="giscus-alt-theme" value="light">
<script>
  function loadGiscus() {
    // Function to get the theme based on body class
    const getTheme = () => {
      let baseTheme = document.getElementById('giscus-base-theme').value;
      let altTheme = document.getElementById('giscus-alt-theme').value;
      return document.body.classList.contains('quarto-dark') ? altTheme : baseTheme;
    };
    const script = document.createElement("script");
    script.src = "https://giscus.app/client.js";
    script.async = true;
    script.dataset.repo = "ForBo7/forbo7.github.io";
    script.dataset.repoId = "R_kgDOICXnAA";
    script.dataset.category = "Giscus Comments";
    script.dataset.categoryId = "DIC_kwDOICXnAM4CR8YX";
    script.dataset.mapping = "title";
    script.dataset.reactionsEnabled = "1";
    script.dataset.emitMetadata = "0";
    script.dataset.inputPosition = "top";
    script.dataset.theme = getTheme();
    script.dataset.lang = "en";
    script.crossOrigin = "anonymous";
    // Append the script to the desired div instead of at the end of the body
    document.getElementById("quarto-content").appendChild(script);
  }
  loadGiscus();
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p><a href="https://forbo7.github.io/">ForBo7 // Salman Naqvi</a> © 2022–2025 to ∞ and ForBlog™ by <a href="https://forbo7.github.io/about.html">Salman Naqvi</a></p>
</div>   
    <div class="nav-footer-center">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://forums.fast.ai/u/forbo7/summary">
      <i class="bi bi-file-post-fill" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/ForBo7_">
      <i class="bi bi-twitter" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://www.artstation.com/forbo7">
      <i class="bi bi-brush" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="mailto:salmananaqvii+forblog@gmail.com">
      <i class="bi bi-envelope" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="../../forblog/index.xml">
      <i class="bi bi-rss" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
    <div class="nav-footer-right">
<p><a href="https://forbo7.github.io/patch_notes.html">Version 2.2.2.0</a> | <a href="https://forbo7.github.io/feedback.html">Feedback</a> | Website made with <a href="https://quarto.org/">Quarto</a>, by me!</p>
</div>
  </div>
</footer>




<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
<script src="../../site_libs/quarto-contrib/line-highlight-1.0.0/line-highlight.js" defer="true"></script>
</body></html>